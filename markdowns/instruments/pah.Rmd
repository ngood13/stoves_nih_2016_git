---
title: "Process PAH data"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r load_libraries, echo=FALSE, message=FALSE}
  if (!require("pacman")) install.packages("pacman")
  pacman::p_load(tidyverse, kableExtra)
```

```{r global_options, echo=FALSE}
  knitr::opts_chunk$set(fig.path ='figures/', 
                        fig.width = 12, fig.height = 5,
                        warning = FALSE, message = FALSE, cache = FALSE)
```

# tidy data

## load files

load scripts

```{r}
  source("../../scripts/functions.R")
```

load data

```{r}
  pah_raw <- readRDS("../../r_data/pah.RDS")    # pah dataset
  pah_lod <- readRDS("../../r_data/pah_lod.RDS")    # pah lod dataset
  data_1 <- readRDS("../../r_data/data_1.RDS")
  notes <- readRDS("../../r_data/notes.RDS")
  samples <- readRDS("../../r_data/samples.RDS")
```

## lod

extract chemical analysis lod data

```{r}
  lod <-
    pah_lod %>%
    dplyr::mutate(lod = ifelse(val == "BDL", "below", "above")) %>%
    dplyr::select(-val)
```

lod replacement

* replace values below the lod with lod/sqrt(2)

```{r}
  pah <- 
    pah_raw %>% 
    dplyr::mutate(val = as.numeric(val)) %>%
    dplyr::left_join(lod, by = c("id_asu", "id", "filter_type", "pol")) %>%
    dplyr::group_by(id, pol, filter_type) %>%
    dplyr::summarise(val = last(val), lod = last(lod)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(val_lod_adj = ifelse(lod == "below", val / sqrt(2), val))
```

## flags

* extract flags

```{r}
  notes <- 
    notes %>%
    dplyr::filter(grepl("pah|all", inst) == TRUE)
```

* bad preceeds maybe preceeds good

```{r}
  flags <-
    notes %>%
    dplyr::select(id, qc) %>%
    dplyr::group_by(id) %>%
    dplyr::arrange(qc) %>%
    dplyr::summarise(qc = first(qc))
```

* add flag by id

```{r}
  pah <-
    pah %>%
    dplyr::left_join(flags, by = "id") %>%
    dplyr::mutate(id = as.factor(id)) %>%
    dplyr::mutate(qc = as.factor(ifelse(is.na(qc), "ok", as.character(qc))))
```

## test type 

define test type variable

```{r}
  pah <- 
    pah %>%
    dplyr::mutate(test_type = ifelse(!grepl("^B|^G", id), "test", "bg"),
                  test_type = ifelse(grepl("^B", id), "blank", test_type))
```

extract four pollutants to represent all pahs

* can be turned on or off

```{r}
  pah <-
    pah %>%
    dplyr::filter(grepl("^pyrene$|a]pyrene|fluorene|^anthracene$", pol))
```

## bad tests

```{r}
  pah_bad <-
    pah %>% 
    dplyr::filter(qc == "bad")
```

```{r}
  pah <-
    pah %>% 
    dplyr::filter(qc != "bad")
```

# blank analysis 

extract blanks

```{r}
  blanks <-
    pah %>%
    dplyr::filter(test_type == "blank")
```

## table: lab blank outliers

outliers (z > 3) when blanks are grouped by pollutant and filter type

```{r, echo=FALSE}
  blanks %>%
    dplyr::filter(!is.na(val_lod_adj)) %>%
    dplyr::group_by(pol, filter_type) %>%
    dplyr::mutate(z_score = (val_lod_adj - mean(val_lod_adj, na.rm = TRUE))/ sd(val_lod_adj, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "ba")) %>%
    dplyr::select(id, pol, filter_type, z_score) %>%
    dplyr::filter(z_score > 3) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

conclusions: 

* blanks look good! 
* some outliers, but they are not consistent across pollutants (possibly investiage B18 and B27)

## plot: time series of lab blanks

lab blanks (ug)

* shape indicates if sample was above or below instrument lod

```{r, echo=FALSE, fig.height = 16, fig.width = 14}
 blanks %>%
    dplyr::filter(!is.na(val)) %>%
    dplyr::left_join(dplyr::select(samples, blank, date), by = c('id' = 'blank')) %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "ba")) %>%
    ggplot(aes_string(x = "date", y = "val_lod_adj")) +
      geom_point(aes(shape = lod), size = 4) +
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 20),
            legend.position = "top") +
      labs(shape = "chemical analysis lod") +
      facet_wrap(pol~filter_type, ncol = 3, scales = "free_x") +
      ylab("micrograms") +
      xlab("blank id")
```

conclusions: 

* blanks look good!
* no obvious trends in time.

## table: lab blanks below lod for chemical analysis

percent of lab blanks below the lod for chemical analysis

```{r, echo=FALSE}
  blanks %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "ba")) %>%
    dplyr::group_by(filter_type, pol) %>%
    dplyr::do(val = round(nrow(filter(., lod == "below"))/nrow(.), 2) * 100) %>%
    dplyr::mutate(val = cell_spec(val, "html", color = ifelse(val > 10, "red", "blue"))) %>%
    tidyr::spread(filter_type, val) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

## table: lab blanks with NA values

percent of lab blanks with NA values

```{r, echo=FALSE}
  blanks %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "ba")) %>%
    dplyr::group_by(filter_type, pol) %>%
    dplyr::do(val = round(nrow(filter(., is.na(val_lod_adj) == TRUE))/nrow(.), 2) * 100) %>%
    dplyr::mutate(val = cell_spec(val, "html", color = ifelse(val > 10, "red", "blue"))) %>%
    tidyr::spread(filter_type, val) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

## table: blank summary

summarize blanks

```{r}
  blanks <-
    blanks %>%
    dplyr::group_by(pol, filter_type) %>%
    dplyr::summarise(bk_mean = mean(val_lod_adj, na.rm = TRUE),
                     bk_median = median(val_lod_adj, na.rm = TRUE),
                     bk_sd = sd(val_lod_adj, na.rm = TRUE)) %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("p" = "ba"))
```

summary of lab blanks (ug)

```{r, echo=FALSE}
  blanks %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "p")) %>%
    knitr::kable(digits = 2, align = 'c',
                 col.names = c("type of pah", "filter type", "mean", "median", "standard deviation"))
```

## save blanks

```{r}
  saveRDS(blanks, file = "../../r_data/pah_bk.RDS")
```

remove lab blanks from pah_merged file

```{r}
  pah_merged <-
    pah %>%
    dplyr::filter(test_type != "blank") # remove blanks
```

# missing data

check for missing data

```{r}
  pah_missing <-
    pah_merged %>%
    dplyr::select(id, pol, filter_type) %>%
    dplyr::ungroup() %>%
    dplyr::group_by(id, filter_type) %>%
    dplyr::summarise(n = n()) %>%
    tidyr::spread(filter_type, n) %>%
    dplyr::filter(!grepl("10D|8E|D2", id)) %>%
    tidyr::gather("filter_type", "n", 2:4) %>%
    dplyr::filter(is.na(n)) %>%
    dplyr::select(-n)
```

remove all data from tests that are missing a filter or front puf

```{r}
  pah_merged <-
    dplyr::anti_join(pah_merged,
                     pah_missing %>%
                     dplyr::filter(filter_type != "b") %>%
                     dplyr::select(id), by = "id") %>%
    dplyr::filter(!grepl("10D|8E", id))
```

## table: filters that weren't analyzed 

* we have measurements for 10D-B and 8E-B, which don't match our test ids
* any tests that are missing a filter or front puf are removed from the analysis

```{r}
  pah_missing %>%
    dplyr::left_join(dplyr::select(samples, id,
                                   stove, fuel), by = "id") %>%
    dplyr::mutate(filter_type = ifelse(filter_type == "b", "back puf", filter_type),
                  filter_type = ifelse(filter_type == "f", "front puf", filter_type),
                  filter_type = ifelse(filter_type == "p", "filter", filter_type)) %>%
    knitr::kable("markdown", align = 'c')
```

## table: tests that have bad data

```{r}
  pah_bad  %>%
    dplyr::distinct(id) %>%
    dplyr::left_join(dplyr::select(samples, id,
                                   stove, fuel), by = "id") %>%
    knitr::kable("markdown", align = 'c')
```

conclusions: 

* stove design malfunction (no need to repeat tests)

# concentration calculations

## extract data

extract red cartridge data

```{r}
  meta <-
    data_1 %>%
    dplyr::select(matches("_red|^id$|^date$"))
```

extract flow rate data

```{r}
  flows <-
    meta %>%
    dplyr::select(matches("flow_|^id$|^date$")) %>%
    tidyr::gather("var", "value", -id, -date) %>%
    dplyr::filter(grepl("_avg$", var)==FALSE) %>%
    dplyr::mutate(type = sub("flow.*", "", var),
                  rep = as.factor(gsub("[^0-9]", "", var))) %>%
    dplyr::select(-var)  %>%
    dplyr::filter(!is.na(id)) %>%
    dplyr::group_by(rep, id, type) %>%
    dplyr::mutate(mean = mean(value, na.rm = TRUE))  %>%
    dplyr::ungroup() %>%
    dplyr::filter(rep == 1) %>%
    dplyr::select(-value, -rep, -date)  %>%
    tidyr::spread(type, mean)
```

extract time data

```{r}
  times <-
    meta %>% 
    dplyr::select(matches("^time_|^id$|^date$")) %>%
    tidyr::gather("var", "value", -id, -date) %>%
    dplyr::mutate(type = ifelse(grepl("_start_", var), "start", "NA"),
                  type = ifelse(grepl("_end_", var), "end", type)) %>%
    dplyr::arrange(id) %>%
    dplyr::filter(!is.na(id)) %>%  
    dplyr::select(-var, -date) %>%  
    tidyr::spread(type, value)
```

## merge and calculate

merge data with flows and times

```{r}
  pah_merged <-
    pah_merged %>%
    dplyr::filter(test_type != "blank") %>%
    dplyr::left_join(flows, by = "id") %>%
    dplyr::left_join(times, by = "id") %>%
    dplyr::rename(pre_flow = pre, post_flow = post) %>%
    dplyr::mutate(flow = (pre_flow + post_flow) / 2)
```

calculate concentrations

```{r}
  pah_merged <-
    pah_merged %>%
    dplyr::mutate(dur = (end - start) / 60,
                  conc = val_lod_adj * 1000 / (flow * dur))
```

# backgrounds

extract background pufs (front and back) and background filters

```{r}
  bg <-
    pah_merged %>%
    dplyr::filter(test_type == "bg")
```

## plot: lab background outliers

outliers (z > 3) when backgrounds are grouped by pollutant and filter type

```{r pah_bg_plot, echo=FALSE, fig.height = 8}
  bg %>%
    dplyr::filter(!is.na(conc)) %>%
    dplyr::group_by(pol, filter_type, test_type) %>%
    dplyr::mutate(z_score = (conc - mean(conc, na.rm = TRUE))/ sd(conc, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "p")) %>%
    dplyr::select(id, pol, filter_type, z_score) %>%
    dplyr::filter(z_score > 3) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

conclusions: 

* background to invesigate: G2

## plot: time series of lab backgrounds

background concentrations (ug per meter cubed)

* shape indicates if sample was above or below instrument lod

```{r, echo=FALSE, fig.height = 16, fig.width = 14}
 bg %>%
    dplyr::filter(!is.na(conc)) %>%
    dplyr::left_join(dplyr::select(samples, id, date), by = 'id') %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "p")) %>%
    ggplot(aes_string(x = "date", y = "conc")) +
      geom_point(aes(shape = lod), size = 4) +
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 20),
            legend.position = "top") +
      labs(shape = "chemical analysis lod") +
      facet_wrap(pol~filter_type, ncol = 3, scales = "free_x") +
      ylab("") +
      xlab("")
```

conclusions: 

* backgrounds look good! 
* no obvious trends in time

## table: lab backgrounds below lod for chemical analysis

percent of lab backgrounds below the lod of chemical analysis

```{r}
  bg %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "p")) %>%
    dplyr::group_by(filter_type, pol) %>%
    dplyr::do(val = round(nrow(filter(., lod == "below"))/nrow(.), 2) * 100) %>%
    dplyr::mutate(val = cell_spec(val, "html", color = ifelse(val > 10, "red", "blue"))) %>%
    tidyr::spread(filter_type, val) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

## table: lab backgrounds with NA values

percent of lab backgrounds with NA values

```{r}
  bg %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "p")) %>%
    dplyr::group_by(filter_type, pol) %>%
    dplyr::do(val = round(nrow(filter(., is.na(val_lod_adj) == TRUE))/nrow(.), 2) * 100) %>%
    dplyr::mutate(val = cell_spec(val, "html", color = ifelse(val > 10, "red", "blue"))) %>%
    tidyr::spread(filter_type, val) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

## table: background summary

summarize backgrounds

```{r}
  bg <-
    bg %>%
    dplyr::group_by(pol, filter_type) %>%
    dplyr::summarise(bg_mean = mean(conc, na.rm = TRUE),
                     bg_median = median(conc, na.rm = TRUE),
                     bg_sd = sd(conc, na.rm = TRUE))
```

summary of backgrounds (ug per meter cubed)

```{r}
  bg %>%
    dplyr::mutate(filter_type = 
                  filter_type %>% 
                  forcats::fct_recode("back puf" = "b",
                                      "front puf" = "f",
                                      "filter" = "p")) %>%
    knitr::kable(digits = 2, align = 'c',
                 col.names = c("type of pah", "filter type", "mean", "median", "standard deviation"))
```

## save backgrounds

```{r}
  saveRDS(bg, file = "../../r_data/pah_bg.RDS")
```


# sample analysis

extract sample pufs (front and back) and sample filters

```{r}
  pah_samples <-
    pah_merged %>%
    dplyr::filter(test_type == "test")
```

```{r}
  pah_samples <-
    pah_samples %>%
    dplyr::left_join(bg, by = c("pol", "filter_type"))
```

## plot: time series of burns

burn concentrations (ug per meter cubed)

* samples are not background corrected
* shape indicates if sample was above or below instrument lod

```{r, echo=FALSE, fig.height = 16, fig.width = 14}
 pah_samples %>%
    dplyr::filter(!is.na(conc)) %>%
    dplyr::left_join(dplyr::select(samples, id, date), by = 'id') %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "p")) %>%
    ggplot(aes_string(x = "date", y = "conc")) +
      geom_point(aes(shape = lod), size = 4) +
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 20),
            legend.position = "top") +
      labs(shape = "chemical analysis lod") +
      facet_wrap(pol~filter_type, ncol = 3, scales = "free") +
      ylab("") +
      xlab("")
```

conclusions:

* burns look good! 
* no obvious trends in time

## plot: comparing background and sample concentrations

test and background concentrations (ug per meter cubed)

* data is summed across all filter types
* plotted and colored by test type

```{r, echo=FALSE, fig.height = 8, fig.width = 14}
  pah_merged %>%
    dplyr::filter(test_type != 'blank') %>%
    dplyr::group_by(id, pol, test_type) %>%
    dplyr::summarise(conc = sum(conc)) %>%
    dplyr::filter(!is.na(conc)) %>%
    ggplot(aes_string(y = "conc", x = "test_type")) +
      geom_boxplot(outlier.colour = NA) +
      geom_jitter(aes(color = test_type), size = 3) +
      theme_bw() +
      scale_y_log10() +
      theme(text = element_text(size = 20),
            legend.position = "top") +
      labs(color = "test type") +
      ylab("concentration") +
      xlab("") + 
      facet_wrap(~pol, ncol = 2, scales = "free")
```

conclusions: 

* some overlap between burn and background concentrations
* need to investigate ways to account for background measurements (for now, subtract the median)

```{r}
  pah_samples <-
    pah_samples %>%
    dplyr::mutate(conc = conc - bg_median)

  pah_samples_sum <-
    pah_samples %>%
    dplyr::group_by(id, pol, test_type) %>%
    dplyr::summarise(conc = sum(conc)) %>%
    dplyr::ungroup()
```

## table: measurements below the background median

```{r, echo=FALSE}
  pah_samples_sum %>%
    dplyr::left_join(dplyr::select(samples, id, stove, fuel), by = "id") %>%
    dplyr::filter(!is.na(conc), conc < 0) %>%
    dplyr::select(id, pol, stove, fuel, conc) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

## plot: PAH concentrations by stove type

summed particle and gas phase pah concentrations (ug per meter cubed)

* plotted by stove type
* colored by fuel type
* samples are background corrected

```{r, echo=FALSE, fig.height = 16, fig.width = 16}
  pah_samples_p <-
    pah_samples_sum %>%
    dplyr::filter(!is.na(conc), !grepl("27|28|29|30", id)) %>%
    dplyr::left_join(dplyr::select(samples, id, stove, fuel, stovecat, fuelcat), by = "id") %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    tolower %>%
                    gsub(" [:(:].*[:):]", "", .) %>%
                    forcats::fct_relevel("three stone fire",
                                         "clay ring",
                                         "ceramic charcoal",
                                         "rocket elbow",
                                         "built-in justa",
                                         "metal charcoal",
                                         "fan rocket elbow",
                                         "gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg"),
                  fuel = 
                    fuel %>% 
                    tolower,
                  stovecat = 
                    stovecat %>%
                    forcats::fct_recode("insulated [improved] stoves" = "improved",
                                        "insulated [improved] stoves" = "gasifiers",
                                        "liquid-fuel stoves" = "advanced",
                                        "traditional stoves" = "traditional"),
                  fuelcat =
                    fuelcat %>%
                    forcats::fct_recode("liquid" = "advanced"))
  pah_samples_p %>%
    ggplot(aes_string(x = "stove", y = "conc")) +
      geom_boxplot(outlier.colour = NA) +
      geom_jitter(aes(color = factor(fuel)), size = 4,  width = 0.2, shape = 1, stroke = 2) + 
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 20),
            axis.text.x = element_text(angle = 15, hjust = 1, vjust = 1),
            legend.position = "top") +
      facet_wrap(pol~stovecat, ncol = 3, scales = "free") +
      labs(color = "fuel type") +
      ylab("") +
      xlab("")
```

conclusions: 

* some liquid fuel stoves have NA values for pollutants of interest (would rerunning these samples at higher concentrations allow us to resolve values for these stoves?)

## table: outliers by stove type

outliers (z > 3) when samples are grouped by pollutant and stove type

```{r, echo=FALSE}
  pah_samples_p %>%
    dplyr::filter(!is.na(conc)) %>%
    dplyr::group_by(pol, stove) %>%
    dplyr::mutate(z_score = (conc - mean(conc, na.rm = TRUE))/ sd(conc, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::select(id, pol, stove, fuel, z_score) %>%
    dplyr::filter(z_score > 3) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

conclusion:

* no outliers. Looks good! 
* no repeat tests recommended

## plot: PAH concentrations by fuel type

summed particle and gas phase pah concentrations (ug per meter cubed):

* plotted by fuel type
* colored by stove type
* samples are background corrected

```{r, echo=FALSE, fig.height = 16, fig.width = 14}
  pah_samples_p %>%
    ggplot(aes_string(x = "fuel", y = "conc")) +
      geom_boxplot(outlier.colour = NA) +
      geom_jitter(aes(color = factor(stove)), size = 4,  width = 0.2, shape = 1, stroke = 2) + 
      scale_shape(solid = FALSE) +
      guides(fill = FALSE) +
      theme_bw() +
      theme(text = element_text(size = 20),
            axis.text.x = element_text(angle = 15, hjust = 1, vjust = 1),
            legend.position = "top") +
      facet_wrap(pol~fuelcat, ncol = 4, scales = "free") +
      labs(color = "stove type") +
      ylab("") +
      xlab("")
```

conclusions: 

* some liquid fuel stoves have NA values for pollutants of interest (would rerunning these samples at higher concentrations allow us to resolve values for these stoves?)

## table: outliers by fuel type

outliers (z > 3) when samples are grouped by pollutant and fuel type

```{r, echo=FALSE}
  pah_samples_p %>%
    dplyr::filter(!is.na(conc)) %>%
    dplyr::group_by(pol, fuel) %>%
    dplyr::mutate(z_score = (conc - mean(conc, na.rm = TRUE))/ sd(conc, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::select(id, pol, stove, fuel, z_score) %>%
    dplyr::filter(z_score > 3) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

conclusions: 

* a few outliers, but they are not consistent across pollutants
* no repeat tests recommended

## table: burns below lod for chemical analysis

percent of burn samples below the lod of chemical analysis

```{r}
  pah_samples %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "p")) %>%
    dplyr::group_by(filter_type, pol) %>%
    dplyr::do(val = round(nrow(filter(., lod == "below"))/nrow(.), 2) * 100) %>%
    dplyr::mutate(val = cell_spec(val, "html", color = ifelse(val > 10, "red", "blue"))) %>%
    tidyr::spread(filter_type, val) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

## table: burns with NA values

percent of burn samples with NA values

```{r}
  pah_samples %>%
    dplyr::mutate(filter_type = 
                    filter_type %>% 
                    forcats::fct_recode("back puf" = "b",
                                        "front puf" = "f",
                                        "filter" = "p")) %>%
    dplyr::group_by(filter_type, pol) %>%
    dplyr::do(val = round(nrow(filter(., is.na(val_lod_adj) == TRUE))/nrow(.), 2) * 100) %>%
    dplyr::mutate(val = cell_spec(val, "html", color = ifelse(val > 10, "red", "blue"))) %>%
    tidyr::spread(filter_type, val) %>%
    dplyr::rename("pah type" = "pol") %>%
    knitr::kable("markdown", align = 'c')
```

## save data

```{r}
  saveRDS(pah_merged, file = "../../r_data/pah_merged.RDS")
```
