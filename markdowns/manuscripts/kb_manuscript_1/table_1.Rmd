---
title: "figure 1: particle emissions"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r load_libraries, echo=FALSE, message=FALSE}
  if (!require("pacman")) install.packages("pacman")
  pacman::p_load(tidyverse, pals, devtools, patchwork, kableExtra)
  #devtools::install_github("thomasp85/patchwork")
```

```{r global_options, echo=FALSE}
  knitr::opts_chunk$set(fig.path ='figures/',
                        warning = FALSE, message = FALSE, cache = FALSE)
```

# tidy data

## load data

```{r}
  mce <- readRDS("../../../r_data/mce_avg.RDS")
  samples <- readRDS("../../../r_data/samples.RDS")
  fuel <- readRDS("../../../r_data/fuel_merged.RDS")
```

## add stove-fuel info, fuel info and pol properties

```{r}
  mce <-
    mce %>%
    dplyr::inner_join(samples %>%
                        dplyr::select(id, stove, fuel, stovecat, fuelcat), by = "id") %>%
    dplyr::inner_join(fuel, by = c("id", "fuel"))
```

## calculate firepower

```{r}
  mce_fp <-
    mce %>%
    dplyr::mutate(fp = (mass_fuel_comb * 1e-3) / (dur * 60) * lhv)
```

## aggregate data

```{r}
  mce_fp %>%
    dplyr::group_by(stove) %>%
    dplyr::summarise(mce = mean(mce, na.rm = TRUE),
                     fp = mean(fp, na.rm = TRUE)) %>%
    knitr::kable("markdown", digits = 3, align = 'c')
```

