---
title: "figure 2: gas emissions"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r load_libraries, echo=FALSE, message=FALSE}
  if (!require("pacman")) install.packages("pacman")
  pacman::p_load(tidyverse, pals, devtools, patchwork, RColorBrewer)
  #devtools::install_github("thomasp85/patchwork")
```

```{r global_options, echo=FALSE}
  knitr::opts_chunk$set(fig.path ='figures/',
                        warning = FALSE, message = FALSE, cache = FALSE)
```

# tidy data

load data

```{r}
  emissions <- readRDS("../../../r_data/emissions_factors.RDS")
  samples <- readRDS("../../../r_data/samples.RDS")
  pol_properties <- readRDS("../../../r_data/pol_properties.RDS")
```

```{r}
  samples <-
    samples %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "clay ring",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "gasifier",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg"))
```

## add stove fuel info

```{r}
  emissions <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel, stovecat, fuelcat), by = "id") %>%
    dplyr::filter(!is.na(val))
```

## filter out values below background

```{r}
  emissions <-
    emissions %>%
    dplyr::filter(bg != "below")
```

## rename pollutants

```{r}
  emissions <-
    emissions %>%
    dplyr::mutate(pol_category = ifelse(grepl("vocs", pol_category), "volatile organic compounds", pol_category),
                  pol_category = ifelse(grepl("pahs", pol_category), "polycyclic aromatic hydrocarbons", pol_category))
```

## select pollutants

```{r}
  carbonyls <-
    emissions %>%
    dplyr::filter(grepl("carbonyls", pol_category)) %>%
    dplyr::filter(metric == "energy_delivered_ef")
```

```{r}
  vocs <-
    emissions %>%
    dplyr::filter(grepl("volatile organic compounds", pol_category)) %>%
    dplyr::filter(metric == "energy_delivered_ef")
```

## select pollutants

```{r}
  pahs <-
    emissions %>%
    dplyr::filter(grepl("aromatic", pol_category), pol != "napthalene") %>%
    dplyr::filter(metric == "energy_delivered_ef")
```

# check for outliers

## carbonyls

```{r, echo=FALSE, fig.width=10, fig.height=8, eval=FALSE}
  carbonyls %>%
    dplyr::group_by(id, stove, fuel) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    ggplot(aes(x = id, y = val, color = fuel)) +
    geom_point() +
    theme_bw() +
    theme(text = element_text(size = 12),
          legend.position = "top") +
    facet_wrap(~stove, scales = "free")
```

## vocs

```{r, echo=FALSE, eval=FALSE,fig.width=10, fig.height=8}
  vocs %>%
    dplyr::group_by(id, stove, fuel) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    ggplot(aes(x = id, y = val, color = fuel)) +
    geom_point() +
    theme_bw() +
    theme(text = element_text(size = 12),
          legend.position = "top") +
    facet_wrap(~stove, scales = "free")
```

## pahs

```{r, echo=FALSE, eval=FALSE, fig.width=10, fig.height=8}
  pahs %>%
    dplyr::group_by(id, stove, fuel) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    ggplot(aes(x = id, y = val, color = fuel)) +
    geom_point() +
    theme_bw() +
    theme(text = element_text(size = 12),
          legend.position = "top") +
    facet_wrap(~stove, scales = "free")
```

## remove tests

```{r}
  vocs <- 
    vocs %>%
    dplyr::filter(id != "5A", id != "9A")
```

notes: need to look at these tests still

## calculate stats

```{r}
  stats_carbs <-
    carbonyls %>%
    dplyr::group_by(id, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stove, stovecat) %>%
    dplyr::summarise(min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    tidyr::gather("var", "val", min, max) %>%
    dplyr::mutate(sym = ifelse(var == "min", "[", "]"))
```

```{r}
  stat_vocs <-
    vocs %>%
    dplyr::group_by(id, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stove, stovecat) %>%
    dplyr::summarise(min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    tidyr::gather("var", "val", min, max) %>%
    dplyr::mutate(sym = ifelse(var == "min", "[", "]"))
```

```{r}
  stats_pahs <-
    pahs %>%
    dplyr::group_by(id, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stove, stovecat) %>%
    dplyr::summarise(min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    tidyr::gather("var", "val", min, max) %>%
    dplyr::mutate(sym = ifelse(var == "min", "[", "]"))
```

## calculate means by pollutant

```{r}
  carbonyls_p <-
    carbonyls %>%
    dplyr::group_by(id, pol_subcategory, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(pol_subcategory, stove, stovecat) %>%
    dplyr::summarise(val = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(pol_subcategory = 
                    pol_subcategory %>% 
                    factor %>% 
                    fct_recode("saturated aldehydes " = "saturated aldehydes",
                               "unsaturated aldehydes " = "unsaturated aldehydes",
                               "aromatic aldehydes " = "aromatic aldehydes",
                               "ketones " = "ketones") %>% 
                    forcats::fct_relevel("saturated aldehydes ",
                                         "unsaturated aldehydes ",
                                         "aromatic aldehydes ",
                                         "ketones ") %>%
                    forcats::fct_rev(),
                  pol_category = "carbonyls")
```

```{r}
  vocs_p <-
    vocs %>%
    dplyr::group_by(id, pol_subcategory, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(pol_subcategory, stove, stovecat) %>%
    dplyr::summarise(val = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(pol_subcategory = 
                    pol_subcategory %>%
                    factor %>% 
                    fct_recode("alkanes " = "alkanes",
                               "alkenes " = "alkenes",
                               "alkynes " = "alkynes",
                               "aromatics " = "aromatics") %>%
                    forcats::fct_relevel("alkanes ",
                                         "alkenes ",
                                         "alkynes ",
                                         "aromatics ") %>%
                    forcats::fct_rev(),
                  pol_category = "volatile organic compounds")
```

```{r}
  pahs_p <-
    pahs %>%
    dplyr::group_by(id, pol_subcategory, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(pol_subcategory, stove, stovecat) %>%
    dplyr::summarise(val = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(pol_subcategory = 
                    pol_subcategory %>% 
                    factor %>% 
                    fct_recode("three rings " = "three rings",
                               "four rings " = "four rings",
                               "five rings " = "five rings",
                               "six rings " = "six rings") %>%
                    forcats::fct_relevel("three rings ",
                                         "four rings ",
                                         "five rings ",
                                         "six rings ") %>%
                    forcats::fct_rev(),
                  pol_category = "polycyclic aromatic hydrocarbons")
```

# figures

```{r, echo=FALSE}
  col_vector = c("cornflowerblue",
                 "khaki",
                 "slateblue3",
                 "#9e9ac8")

  p1 <-
    carbonyls_p %>%
    dplyr::mutate(pol_category = "Carbonyl Compounds") %>%
    ggplot(aes(x = stove, y = val)) +
      geom_histogram(aes(fill = pol_subcategory, order = pol_subcategory), stat = "identity") +
      geom_text(data = stats_carbs,
                aes(x = stove, y = val, label = sym), stroke = 2, size = 10, angle = 90, nudge_x = -0.05) +
      theme_minimal() +
      scale_fill_manual(values = col_vector,
                        name = "carbonyls") +
      #scale_y_continuous(limits = c(0, 100)) +
      theme(text = element_text(size = 20),
            axis.text.y = element_text(size = 18),
            strip.text.x = element_text(size = 20),
            axis.title.y = element_blank(),
            axis.title.x = element_blank(),
            axis.text.x = element_blank(),
            legend.position = "top",
            legend.title = element_blank()) +
      facet_wrap(~pol_category, scales = "free")
```

```{r, echo=FALSE}
  p2 <-
    vocs_p %>%
    dplyr::mutate(pol_category = "Volatile Organic Compounds") %>%
    ggplot(aes(x = stove, y = val)) +
      geom_histogram(aes(fill = pol_subcategory, order = pol_subcategory), stat = "identity") +
      geom_text(data = stat_vocs,
                aes(x = stove, y = val, label = sym), size = 10, angle = 90, nudge_x = -0.02) +
      scale_fill_manual(values = c("#fc8d62", "coral3", "slategray2", "#0072B2"),
                        name = "VOCs") +
      scale_y_continuous(limits = c(0, 2000)) +
      annotate("text", x = 1, y = 2000, label = "2251", size = 5) +
      annotate("text", x = 2, y = 2000, label = "3254", size = 5) +
      theme_minimal() +
      theme(text = element_text(size = 20),
            axis.text.y = element_text(size = 18),
            strip.text.x = element_text(size = 20),
            axis.title.y = element_blank(),
            axis.title.x = element_blank(),
            axis.text.x = element_blank(),
            legend.position = "top",
            legend.title = element_blank(),
            legend.margin = margin(c(1, 10, 5, 10), "pt")) +
      facet_wrap(~pol_category, scales = "free")
```

```{r, echo=FALSE}
  p3 <-
    pahs_p %>%
    dplyr::mutate(pol_category = "Polycyclic Aromatic Hydrocarbons") %>%
    ggplot(aes(x = stove, y = val)) +
      geom_histogram(aes(fill = pol_subcategory, order = pol_subcategory), stat = "identity") +
      geom_text(data = stats_pahs,
                aes(x = stove, y = val, label = sym), size = 10, angle = 90, nudge_x = -0.02) +
      scale_fill_manual(values = c("gray36", "grey", "darkcyan", "yellowgreen"),
                        name = "PAHs") +
      scale_y_continuous(limits = c(0, 30)) +
      annotate("text", x = 1, y = 30, label = "36.1", size = 5) +
      annotate("text", x = 2, y = 30, label = "56.3", size = 5) +
      annotate("text", x = 3, y = 30, label = "73.6", size = 5) +
      theme_minimal() +
      theme(text = element_text(size = 20),
            axis.text.y = element_text(size = 18),
            axis.title.y = element_blank(),
            axis.text.x = element_blank(),
            axis.title.x = element_blank(),
            strip.text.x = element_text(size = 20),
            legend.position = "top",
            legend.title = element_blank()) +
      facet_wrap(~pol_category, scales = "free")
```

```{r figure_2, echo=FALSE, fig.width=10, fig.height=12}
  p1 + plot_spacer() + p2 + plot_spacer() + p3 + plot_layout(nrow = 5,
                                                             heights = c(1, 0.10, 1, 0.10, 1))
```

# tables

## carbonyls

average carbonyls by stove type (total)

```{r, echo=FALSE}
  carbonyls %>%
    dplyr::group_by(id, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stove, stovecat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(stove = gsub("\n", " ", stove)) %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average formaldeyde by stove type

```{r, echo=FALSE}
  carbonyls %>%
      dplyr::filter(grepl("form", pol)) %>%
    dplyr::group_by(id, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stove, stovecat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(stove = gsub("\n", " ", stove)) %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average acetaldeyde by stove type

```{r, echo=FALSE}
  carbonyls %>%
      dplyr::filter(grepl("acet", pol)) %>%
    dplyr::group_by(id, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stove, stovecat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(stove = gsub("\n", " ", stove)) %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average carbonyls by stove type (by pollutant)

```{r, echo=FALSE}
  carbonyls %>%
    dplyr::group_by(stove, pol) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(stove = gsub("\n", " ", stove)) %>%
    dplyr::arrange(stove, mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average carbonyls by stovecat (total)

```{r, echo=FALSE}
  carbonyls %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

fraction of total emissions made up of formaldehyde

```{r, echo=FALSE}
  formaldehyde <-
    carbonyls %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::filter(grepl("form", pol)) %>%
    dplyr::summarise(form_mean = mean(val, na.rm = TRUE))

  carbonyls %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(all_mean = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::left_join(formaldehyde, by = "fuelcat") %>%
    dplyr::mutate(ratio = form_mean / all_mean) %>%
    dplyr::arrange(ratio) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

fraction of total emissions made up of formaldehyde + acetaldehyde

```{r, echo=FALSE}
  formaldehyde <-
    carbonyls %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::filter(grepl("formal|acet", pol)) %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(form_mean = mean(val, na.rm = TRUE))

  carbonyls %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(all_mean = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::left_join(formaldehyde, by = "fuelcat") %>%
    dplyr::mutate(ratio = form_mean / all_mean) %>%
    dplyr::arrange(ratio) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average carbonyls by stove type (by pollutant)

```{r, echo=FALSE}
  carbonyls %>%
    dplyr::group_by(fuelcat, pol) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(fuelcat, mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average carbonyls by fuel type (total)

```{r, echo=FALSE}
  carbonyls %>%
    dplyr::group_by(id, fuel) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuel) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average carbonyls by fuelcat

```{r, echo=FALSE}
  carbonyls %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average carbonyls by fuelcat (by pollutant)

```{r, echo=FALSE}
  carbonyls %>%
    dplyr::group_by(fuelcat, pol) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(fuelcat, mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

## vocs

average vocs by stove type (total)

```{r, echo=FALSE}
  vocs %>%
    dplyr::group_by(id, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stove, stovecat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(stove = gsub("\n", " ", stove)) %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 3, align = 'c')
```

average vocs by stove type (by pollutant)

```{r, echo=FALSE}
  vocs %>%
    dplyr::group_by(id, stove, pol_subcategory) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stove, pol_subcategory) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(stove = gsub("\n", " ", stove)) %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 3, align = 'c')
```

average vocs by stovecat (total)

```{r, echo=FALSE}
  vocs %>%
    dplyr::group_by(id, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stovecat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 3, align = 'c')
```

average vocs by stovecat (by pollutant)

```{r, echo=FALSE}
  vocs %>%
    dplyr::group_by(id, stovecat, pol_subcategory) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stovecat, pol_subcategory) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 3, align = 'c')
```

ratio of total to aromatics

```{r, echo=FALSE}
  aromatics <-
    vocs %>%
      dplyr::filter(pol_subcategory == "aromatics") %>%
      dplyr::group_by(id, fuelcat) %>%
      dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
      dplyr::group_by(fuelcat) %>%
      dplyr::summarise(mean_aromatics = mean(val, na.rm = TRUE))

  vocs %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(all_mean = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::left_join(aromatics, by = "fuelcat") %>%
    dplyr::mutate(ratio = mean_aromatics / all_mean) %>%
    dplyr::arrange(ratio) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

ratio of total to alkenes

```{r, echo=FALSE}
  alkenes <-
    vocs %>%
      dplyr::filter(pol_subcategory == "alkenes") %>%
      dplyr::group_by(id, fuelcat) %>%
      dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
      dplyr::group_by(fuelcat) %>%
      dplyr::summarise(mean_alkenes = mean(val, na.rm = TRUE))

  vocs %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(all_mean = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::left_join(alkenes, by = "fuelcat") %>%
    dplyr::mutate(ratio = mean_alkenes / all_mean) %>%
    dplyr::arrange(ratio) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

ratio of total to alkanes

```{r, echo=FALSE}
  alkanes <-
    vocs %>%
      dplyr::filter(pol_subcategory == "alkanes") %>%
      dplyr::group_by(id, fuelcat) %>%
      dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
      dplyr::group_by(fuelcat) %>%
      dplyr::summarise(mean_alkanes = mean(val, na.rm = TRUE))

  vocs %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(all_mean = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::left_join(alkanes, by = "fuelcat") %>%
    dplyr::mutate(ratio = mean_alkanes / all_mean) %>%
    dplyr::arrange(ratio) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

ratio of total to aromatics

```{r, echo=FALSE}
  benzene <-
    vocs %>%
      dplyr::filter(pol == "benzene") %>%
      dplyr::group_by(id, fuelcat) %>%
      dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
      dplyr::group_by(fuelcat) %>%
      dplyr::summarise(mean_benzene = mean(val, na.rm = TRUE))

  vocs %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(all_mean = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::left_join(benzene, by = "fuelcat") %>%
    dplyr::mutate(ratio = mean_benzene / all_mean) %>%
    dplyr::arrange(ratio) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

```{r, echo=FALSE}
  vocs %>%
      dplyr::filter(grepl("ethyne", pol)) %>%
    dplyr::group_by(id, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stove, stovecat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(stove = gsub("\n", " ", stove)) %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average vocs by fuel type (total)

```{r, echo=FALSE}
  vocs %>%
    dplyr::group_by(id, fuel) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuel) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 3, align = 'c')
```

average vocs by fuelcat

```{r, echo=FALSE}
  vocs %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 3, align = 'c')
```

average vocs by fuelcat (by pollutant)

```{r, echo=FALSE}
  vocs %>%
    dplyr::group_by(id, fuelcat, pol_subcategory) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat, pol_subcategory) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(fuelcat, mean) %>%
    knitr::kable("markdown", digits = 3, align = 'c')
```

ratio of total to aromatics

```{r, echo=FALSE}
  aromatics <-
    vocs %>%
      dplyr::filter(pol_subcategory == "aromatics") %>%
      dplyr::group_by(id, fuelcat) %>%
      dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
      dplyr::group_by(fuelcat) %>%
      dplyr::summarise(mean_aromatics = mean(val, na.rm = TRUE))

  vocs %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(all_mean = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::left_join(aromatics, by = "fuelcat") %>%
    dplyr::mutate(ratio = mean_aromatics / all_mean) %>%
    dplyr::arrange(ratio) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

## pahs

ratio of three and four ring pahs to total

```{r, echo=FALSE}
  low_mw <-
    pahs %>%
      dplyr::filter(grepl("three|four", pol_subcategory)) %>%
      dplyr::group_by(id, fuelcat) %>%
      dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
      dplyr::group_by(fuelcat) %>%
      dplyr::summarise(mean_low_mw_pahs = mean(val, na.rm = TRUE))

  pahs %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(all_mean = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::left_join(low_mw, by = "fuelcat") %>%
    dplyr::mutate(ratio = mean_low_mw_pahs / all_mean) %>%
    dplyr::arrange(ratio) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

ratio of bap to total

```{r, echo=FALSE}
  bap <-
    pahs %>%
      dplyr::filter(grepl("b.a.pyrene", pol)) %>%
      dplyr::group_by(id, fuelcat) %>%
      dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
      dplyr::group_by(fuelcat) %>%
      dplyr::summarise(bap_mean = mean(val, na.rm = TRUE))

  pahs %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(all_mean = mean(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::left_join(bap, by = "fuelcat") %>%
    dplyr::mutate(ratio = bap_mean / all_mean) %>%
    dplyr::arrange(ratio) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average pahs by stove type (total)

```{r, echo=FALSE}
  pahs %>%
    dplyr::group_by(id, stove, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stove, stovecat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(stove = gsub("\n", " ", stove)) %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average pahs by stove type (by pollutant)

```{r, echo=FALSE}
  pahs %>%
    dplyr::group_by(stove, pol_subcategory) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(stove = gsub("\n", " ", stove)) %>%
    dplyr::arrange(stove, mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average pahs by stovecat (total)

```{r, echo=FALSE}
  pahs %>%
    dplyr::group_by(id, stovecat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(stovecat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average pahs by stove type (by pollutant)

```{r, echo=FALSE}
  pahs %>%
    dplyr::group_by(stovecat, pol_subcategory) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(stovecat, mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average pahs by fuel type (total)

```{r, echo=FALSE}
  pahs %>%
    dplyr::group_by(id, fuel) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuel) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average pahs by fuelcat

```{r, echo=FALSE}
  pahs %>%
    dplyr::group_by(id, fuelcat) %>%
    dplyr::summarise(val = sum(val, na.rm = TRUE)) %>%
    dplyr::group_by(fuelcat) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```

average pahs by fuelcat (by pollutant)

```{r, echo=FALSE}
  pahs %>%
    dplyr::group_by(fuelcat, pol_subcategory) %>%
    dplyr::summarise(mean = mean(val, na.rm = TRUE),
                     min = min(val, na.rm = TRUE),
                     max = max(val, na.rm = TRUE)) %>%
    dplyr::ungroup() %>%
    dplyr::arrange(fuelcat, mean) %>%
    knitr::kable("markdown", digits = 2, align = 'c')
```