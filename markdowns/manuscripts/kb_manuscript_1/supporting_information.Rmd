---
title: "SUPPORTING INFORMATION"
geometry: margin=0.5in
output:
  pdf_document:
    toc: false
---

```{r load_libraries, echo=FALSE, message=FALSE}
  if (!require("pacman")) install.packages("pacman")
  pacman::p_load(tidyverse, patchwork, knitr, kableExtra, forcats,
                 RColorBrewer, stringi, pBrackets)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path='figures/', warning=FALSE, message=FALSE, cache=FALSE, echo=FALSE)
```

```{r, echo=FALSE}
  emissions <- readRDS("../../../r_data/emissions_factors.RDS")
  samples <- readRDS("../../../r_data/samples.RDS")
  fuels <- readRDS("../../../r_data/fuel_properties.RDS")
  pol_properties <- readRDS("../../../r_data/pol_properties.RDS")
```

```{r, echo=FALSE}
  mod_1 <- readRDS("model_confint/mod_1.RDS")
  mod_2 <- readRDS("model_confint/mod_2.RDS")
  mod_3 <- readRDS("model_confint/mod_3.RDS")
  mod_4 <- readRDS("model_confint/mod_4.RDS")
  mod_5 <- readRDS("model_confint/mod_5.RDS")
  mod_6 <- readRDS("model_confint/mod_6.RDS")
  mod_7 <- readRDS("model_confint/mod_7.RDS")
```

```{r, echo=FALSE}
  mod_1_c <- readRDS("model_confint/mod_1_c.RDS")
  mod_2_c <- readRDS("model_confint/mod_2_c.RDS")
  mod_3_c <- readRDS("model_confint/mod_3_c.RDS")
  mod_4_c <- readRDS("model_confint/mod_4_c.RDS")
  mod_5_c <- readRDS("model_confint/mod_5_c.RDS")
  mod_6_c <- readRDS("model_confint/mod_6_c.RDS")
  mod_7_c <- readRDS("model_confint/mod_7_c.RDS")
```

\begin{center}
\LARGE{Household Cookstoves: A Comprehensive Laboratory Assessment of Air Pollutant Emissions}
\end{center}

Kelsey R. Bilsback, Jordyn Dahlke, Kristen Fedak, Nicholas Good, Arsineh Hecobian, Pierre Herckes, Christian Lâ€™Orange, John Mehaffy, Amy Sullivan, Jessica Tryner, Lizette Van Zyl, Ethan Walker, Ander Wilson, Jennifer L. Peel, John Volckens

\tableofcontents
\newpage

# 1. Stove and fuel information

## Stove-fuel test matrix

```{r test_matrix, fig.height=10, fig.width=14, eval=FALSE}
  samples %>%
    dplyr::select(id, stove, fuel, type) %>%
    dplyr::mutate(stove = as.character(stove),
                  fuel = as.character(fuel),
                  fuel = ifelse(fuel == "west slope pellets", "lodgepole pine pellets", fuel)) %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "lpg",
                                         "wick kerosene",
                                         "pressure kerosene"),
                  fuel = 
                    fuel %>% 
                    factor %>% 
                    forcats::fct_relevel("oak",
                                         "eucalyptus",
                                         "douglas fir",
                                         "lump hardwood (med.)",
                                         "lump hardwood (sm.)",
                                         "coconut charcoal",
                                         "lodgepole pine pellets",
                                         "eucalyptus pellets",
                                         "lpg",
                                         "kerosene")) %>%
    dplyr::filter(type == "SF") %>%
                 dplyr::group_by(stove, fuel) %>%
                 dplyr::filter(!grepl("^27|^28|^29|^30", id)) %>%
                 dplyr::summarise(id = paste(id, collapse = ", ")) %>%
    ggplot(aes(x = stove, y = fuel)) + 
      geom_tile(colour = "white", width = 0.9, height = 0.9, aes(fill = id, order = id)) +
      theme_bw() +
      theme(legend.position = "none") +
      theme(axis.text.x = element_text(angle = 35, hjust = 1, vjust = 0.75)) +
      theme(text = element_text(size = 20)) +
      geom_text(aes(label = stringr::str_wrap(id, 9), size = 5)) +
      xlab("") +
      ylab("")
```

```{r, echo=FALSE, out.width = '100%'}
  knitr::include_graphics("test_matrix.png")
```

## Stove information

```{r}
  tibble::data_frame("id" = c("a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k"),
                     "stove name" = c("three-stone fire",
                                      "chulha",
                                      "rocket-elbow",
                                      "built-in plancha (with chimney)",
                                      "fan rocket-elbow",
                                      "forced-draft gasifier",
                                      "ceramic charcoal",
                                      "metal charcoal",
                                      "wick kerosene",
                                      "pressurized kerosene",
                                      "lpg"),
                     "make" = c("artisan",
                                "artisan",
                                "Envirofit",
                                "Envirofit",
                                "Biolite",
                                "Philips",
                                "artisan",
                                "BURN",
                                "Cook 'n Lite",
                                "Butterfly",
                                "WokSmith"),
                     "model" = c("artisan",
                                "artisan",
                                "G3300",
                                "HM5000",
                                "Homestove$^1$",
                                "HD4012",
                                "artisan",
                                "jikokoa",
                                "82",
                                "2412",
                                "WS-C1-25K"),
                     "photo" = c("", "", "", "", "", "", "", "", "", "", "")) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c') %>%
    kable_styling(position = "center", latex_options = c("scale_down"), font_size = 10) %>%
    footnote(general_title = "Notes: ", threeparttable = TRUE,
             number = c("Stove model in the picture is newer than the one tested"))
```

\pagebreak

## Fuel properties

```{r, echo=FALSE}
  fuels %>%
    dplyr::mutate(carbon_fraction = format(round(carbon_fraction, 2), nsmall = 2, scientific = FALSE),
                  carbon_fraction = ifelse(carbon_fraction == "0.82", "0.82$^2$", carbon_fraction),
                  hhv = ifelse(grepl("00", hhv), paste0(hhv, "$^2$"), hhv)) %>%
    dplyr::rename("HHV (kJ/kg)$^1$" = "hhv",
                  "carbon fraction$^1$" = "carbon_fraction",
                  "moisture content ($\\%$)" = "moisture",
                  "ash content ($\\%$)$^1$" = "ash",
                  "volatile content ($\\%$)$^1$" = "volatile_content",
                  "fixed carbon content ($\\%$)$^1$" = "fixed_carbon") %>%
    kable(escape = FALSE, booktabs = TRUE, align = "c") %>%
    kable_styling(position = "center", font_size = 10, latex_options = c("scale_down", "striped")) %>%
    footnote(general_title = "Notes: ", threeparttable = TRUE,
             number = c("dry basis", "estimated values"), escape = FALSE)
```

# 2. Intrumentation

```{r, echo=FALSE, out.width = '100%'}
  knitr::include_graphics("schematic.png")
```

\newpage

# 3. Particle emissions mass balance

PM$_{2.5}$ mass versus the sum of inorganic ions, elemental carbon, and organic matter. The error bars represent the uncertainty from the Sunset OCEC analyzer measurement. The black line represent the line $y = x$ and the blue lines represent $\pm 20 \%$ deviation from that line.

```{r, echo=FALSE, out.width = '75%', fig.align="center"}
  knitr::include_graphics("../../emissions_factors/figures/mass_balance-1.png")
```

# 4. Carcinogenic compound classifications

```{r}
  tibble::data_frame("pollutant" = c("benzene",
                                    "formaldehyde",
                                    "styrene",
                                    "acetaldehyde",
                                    "isoprene",
                                    "benz[a]anthracene",
                                    "benzo[a]pyrene",
                                    "benzo[b]fluoranthene",
                                    "benzo[j]fluoranthene",
                                    "benzo[k]fluoranthene",
                                    "cyclopenta[cd]pyrene",
                                    "dibenzo[a,h]anthracene",
                                    "indeno[1,2,3-cd]pyrene"),
                     "phase" = c("gas",
                                 "gas",
                                 "gas",
                                 "gas",
                                 "gas",
                                 "particle",
                                 "particle",
                                 "particle",
                                 "particle",
                                 "particle",
                                 "particle",
                                 "particle",
                                 "particle"),
                     "NTP$^1$" = c("Known to be a human carcinogen",
                                   "Known to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "NA",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen"),
                     "IARC$^2$" = c("Group 1: Carcinogenic to humans",
                                    "Group 1: Carcinogenic to humans",
                                    "Group 2A: Probably carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 1: Carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 2A: Probably carcinogenic to humans",
                                    "Group 2A: Probably carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans")) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c') %>%
    kable_styling(position = "center", latex_options = c("striped"), font_size = 8) %>%
    footnote(general_title = "Notes: ", threeparttable = TRUE,
             number = c("National Toxicology Program (NTP)",
                        "International Agency for Research on Cancer (IARC)"))
```

\pagebreak

# 5. Linear regression model

## Coefficients and confidence intervals for pollutant subcategories

* stove type only: 
\[ln(EF) = \alpha_i\]

```{r}
  mod_1 %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha_i$" = "val") %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg")) %>%
    dplyr::arrange(pollutant, stove) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* PM$_{2.5}$ mass only:
\[ln(EF) = \alpha + \beta \cdot PM_{2.5}\]

```{r}
  mod_2 %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha$" = "(Intercept)",
                  "$\\beta$" = "pm_mass") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* CO only:
\[ln(EF) = \alpha + \beta \cdot CO\]

```{r}
  mod_3 %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha$" = "(Intercept)",
                  "$\\beta$" = "co") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* PM$_{2.5}$ mass and CO:
\[ln(EF) = \alpha + \beta_1 \cdot CO + \beta_2 \cdot PM_{2.5}\]

```{r}
  mod_4 %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha$" = "(Intercept)",
                  "$\\beta_1$" = "co",
                  "$\\beta_2$" = "pm_mass") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* PM$_{2.5}$ mass and stove type:
\[ln(EF) = \alpha_i + \beta \cdot PM_{2.5}\]

```{r}
  mod_5 %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha_i$" = "val",
                  "$\\beta$" = "pm_mass") %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg")) %>%
    dplyr::arrange(pollutant, stove) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* CO and stove type:
\[ln(EF) = \alpha_i + \beta \cdot CO\]

```{r}
  mod_6 %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha_i$" = "val",
                  "$\\beta$" = "co") %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg")) %>%
    dplyr::arrange(pollutant, stove) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* PM$_{2.5}$ mass, CO, and stove type:
\[ln(EF) = \alpha_i + \beta_1 \cdot CO + \beta_2 \cdot PM_{2.5}\]

```{r}
  mod_7 %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha_i$" = "val",
                  "$\\beta_1$" = "co",
                  "$\\beta_2$" = "pm_mass") %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg")) %>%
    dplyr::arrange(pollutant, stove) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

## R-squared plot for individual pollutant species

```{r, echo=FALSE, out.width = '60%', fig.align="center"}
  knitr::include_graphics("figures/models_all-1.png")
```

## Model coefficients and confidence intervals for individual pollutant species

* stove type only: 
\[ln(EF) = \alpha_i\]

```{r}
  mod_1_c %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha_i$" = "val") %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg")) %>%
    dplyr::arrange(pollutant, stove) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* PM$_{2.5}$ mass only:
\[ln(EF) = \alpha + \beta \cdot PM_{2.5}\]

```{r}
  mod_2_c %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha$" = "(Intercept)",
                  "$\\beta$" = "pm_mass") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* CO only:
\[ln(EF) = \alpha + \beta \cdot CO\]

```{r}
  mod_3_c %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha$" = "(Intercept)",
                  "$\\beta$" = "co") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```


* PM$_{2.5}$ mass and CO:
\[ln(EF) = \alpha + \beta_1 \cdot CO + \beta_2 \cdot PM_{2.5}\]

```{r}
  mod_4_c %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha$" = "(Intercept)",
                  "$\\beta_1$" = "co",
                  "$\\beta_2$" = "pm_mass") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* PM$_{2.5}$ mass and stove type:
\[ln(EF) = \alpha_i + \beta \cdot PM_{2.5}\]

```{r}
  mod_5_c %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha_i$" = "val",
                  "$\\beta$" = "pm_mass") %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg")) %>%
    dplyr::arrange(pollutant, stove) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* CO and stove type:
\[ln(EF) = \alpha_i + \beta \cdot CO\]

```{r}
  mod_6_c %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha_i$" = "val",
                  "$\\beta$" = "co") %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg")) %>%
    dplyr::arrange(pollutant, stove) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

* PM$_{2.5}$ mass, CO, and stove type:
\[ln(EF) = \alpha_i + \beta_1 \cdot CO + \beta_2 \cdot PM_{2.5}\]

```{r}
  mod_7_c %>%
    dplyr::rename("pollutant" = "pol",
                  "$\\alpha_i$" = "val",
                  "$\\beta_1$" = "co",
                  "$\\beta_2$" = "pm_mass") %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg")) %>%
    dplyr::arrange(pollutant, stove) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("striped", "repeat_header"), font_size = 10)
```

\newpage

# 6. Disaggregated data tables

```{r}
  samples <-
    samples %>%
    dplyr::select(id, stove, fuel, stovecat, fuelcat) %>%
    dplyr::mutate(stove = as.character(stove)) %>%
    dplyr::filter(!grepl("^G|^27|^28|^29|^30", id)) %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg"),
                  fuel = 
                    fuel %>% 
                    factor %>% 
                    forcats::fct_relevel("oak",
                                         "eucalyptus",
                                         "douglas fir",
                                         "lump hardwood (med.)",
                                         "lump hardwood (sm.)",
                                         "coconut charcoal",
                                         "west slope pellets",
                                         "eucalyptus pellets",
                                         "kerosene",
                                         "lpg"))
```

```{r, echo=FALSE}
  emissions <-
    emissions %>%
    dplyr::filter(grepl("energy_delivered_ef|mass_fuel_ef|energy_fuel_ef|emissions_rate", metric)) %>%
    dplyr::select(-qc, -units) %>%
    tidyr::spread("metric", "val") %>%
    dplyr::full_join(samples %>%
                        dplyr::select(id, stove, fuel, stovecat, fuelcat), by = "id") %>%
    dplyr::mutate(id = as_factor(id)) %>%
    dplyr::select(pol, pol_category, pol_subcategory, id, stove, fuel, energy_delivered_ef, mass_fuel_ef,
                  energy_fuel_ef, emissions_rate, lod, bg) %>%
    dplyr::mutate(stove = as.character(stove)) %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "forced-draft gasifier",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg"),
                  fuel = 
                    fuel %>% 
                    factor %>% 
                    forcats::fct_relevel("oak",
                                         "eucalyptus",
                                         "douglas fir",
                                         "lump hardwood (med.)",
                                         "lump hardwood (sm.)",
                                         "coconut charcoal",
                                         "west slope pellets",
                                         "eucalyptus pellets",
                                         "kerosene",
                                         "lpg")) %>%
    dplyr::mutate(pol = ifelse(grepl("^co2$", pol), "carbon dioxide", pol),
                  pol = ifelse(grepl("^co$", pol), "carbon monoxide", pol),
                  pol = ifelse(grepl("^ch4$", pol), "methane", pol),
                  pol = ifelse(grepl("ultrafines", pol), "ultrafine particles", pol),
                  pol = ifelse(grepl("^om$", pol), "organic matter", pol),
                  pol = ifelse(grepl("^oc$", pol), "organic carbon", pol),
                  pol = ifelse(grepl("^ec$", pol), "elemental carbon", pol),
                  pol = ifelse(grepl("pinene", pol), "alpha-pinene", pol),
                  pol = ifelse(grepl("2_methyl_2_butene", pol), "2-methyl-2-butene", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([a-z])", "\\1-\\3", pol),
                  pol = gsub("([a-z])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("(m)(_)(p)", "\\1,\\3", pol),
                  pol = gsub("([a-z])(_)([a-z])", "\\1-\\3", pol))%>%
    dplyr::mutate(pol_subcategory = as.character(pol_subcategory),
                  pol_subcategory = ifelse(grepl("^co2$", pol_subcategory), "carbon dioxide", pol_subcategory),
                  pol_subcategory = ifelse(grepl("^ch4$", pol_subcategory), "methane", pol_subcategory),
                  pol_subcategory = ifelse(grepl("ultrafines", pol_subcategory), "ultrafine particles", pol_subcategory))
```

## Fine particulate matter

```{r}
  fine_pm <-
    emissions %>%
    dplyr::filter(grepl("pm", pol)) %>%
    dplyr::full_join(samples %>%
                       dplyr::select(id, stove, fuel),
                     by = c("id", "stove", "fuel")) %>%
    dplyr::select(-pol_category, -pol_subcategory) %>%
    dplyr::mutate(pol = "PM$_{2.5}$ mass") %>%
    dplyr::mutate(energy_delivered_ef = signif(energy_delivered_ef, 3),
                  mass_fuel_ef = signif(mass_fuel_ef, 3),
                  energy_fuel_ef = signif(energy_fuel_ef, 3),
                  emissions_rate = signif(emissions_rate, 3),
                  energy_delivered_ef = as.character(energy_delivered_ef),
                  mass_fuel_ef = as.character(mass_fuel_ef),
                  energy_fuel_ef = as.character(energy_fuel_ef),
                  emissions_rate = as.character(emissions_rate)) %>%
    dplyr::mutate(energy_delivered_ef = ifelse(lod == "below", paste0(energy_delivered_ef, "*"), energy_delivered_ef),
                  mass_fuel_ef = ifelse(lod == "below", paste0(mass_fuel_ef, "*"), mass_fuel_ef),
                  energy_fuel_ef = ifelse(lod == "below", paste0(energy_fuel_ef, "*"), energy_fuel_ef),
                  emissions_rate = ifelse(lod == "below", paste0(emissions_rate, "*"), emissions_rate),
                  energy_delivered_ef = ifelse(bg == "below", "BB", energy_delivered_ef),
                  mass_fuel_ef = ifelse(bg == "below", "BB", mass_fuel_ef ),
                  energy_fuel_ef = ifelse(bg == "below", "BB", energy_fuel_ef),
                  emissions_rate = ifelse(bg == "below", "BB", emissions_rate))
```

```{r, eval=FALSE}
  # total number 
  fine_pm %>%
    nrow(.)

  # lod 
  fine_pm %>%
    dplyr::filter(lod == "below") %>%
    nrow(.)
```

```{r}
  fine_pm %>%
    dplyr::select(-lod, -bg) %>%
    dplyr::arrange(stove, fuel, id) %>%
    dplyr::rename("pollutant" = "pol",
                  "per-energy-delivered$^1$" = "energy_delivered_ef",
                  "per-time$^2$" = "emissions_rate",
                  "per-fuel-mass$^3$" = "mass_fuel_ef",
                  "per-fuel-energy$^4$" = "energy_fuel_ef") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("repeat_header", "striped"), font_size = 6) %>%
    footnote(general_title = "Notes: ", general = "Results reported to three significant figures; BB indicates a value below background; * indicates a value below the limit of detection; NA indicates a value with a measurement error", threeparttable = TRUE,
             number = c("mg/MJ$_{delivered}$", "mg/hour", "mg/kg$_{fuel}$", "mg/kJ$_{fuel}$"), escape = FALSE)
```

\newpage

## Carbon dioxide, carbon monoxide, and methane

```{r}
  gases <-
    emissions %>%
    dplyr::filter(grepl("monoxide|dioxide|methane", pol)) %>%
    dplyr::select(-pol_category, -pol_subcategory)

  ids <-
    samples %>%
    dplyr::select(id) %>%
    dplyr::mutate(id = as.character(id)) %>%
    as_vector

  pols <-
    gases %>%
    dplyr::select(pol) %>%
    dplyr::distinct() %>%
    dplyr::mutate(pol = as.character(pol)) %>%
    as_vector

  cmpt <-
    expand.grid(pols, ids, stringsAsFactors = FALSE) %>%
    dplyr::rename("pol" = "Var1",
                  "id" = "Var2") %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), 
                     by = "id")

  gases <-
    gases %>%
    dplyr::full_join(cmpt,
                     by = c("pol", "id", "stove", "fuel")) %>%
    dplyr::mutate(energy_delivered_ef = energy_delivered_ef * 1e-3,
                  mass_fuel_ef = mass_fuel_ef * 1e-3,
                  energy_fuel_ef = energy_fuel_ef * 1e-3,
                  emissions_rate = emissions_rate * 1e-3,
                  energy_delivered_ef = signif(energy_delivered_ef, 3),
                  mass_fuel_ef = signif(mass_fuel_ef, 3),
                  energy_fuel_ef = signif(energy_fuel_ef, 3),
                  emissions_rate = signif(emissions_rate, 3),
                  energy_delivered_ef = as.character(energy_delivered_ef),
                  mass_fuel_ef = as.character(mass_fuel_ef),
                  energy_fuel_ef = as.character(energy_fuel_ef),
                  emissions_rate = as.character(emissions_rate)) %>%
    dplyr::mutate(energy_delivered_ef = ifelse(bg == "below", "BB", energy_delivered_ef),
                  mass_fuel_ef = ifelse(bg == "below", "BB", mass_fuel_ef ),
                  energy_fuel_ef = ifelse(bg == "below", "BB", energy_fuel_ef),
                  emissions_rate = ifelse(bg == "below", "BB", emissions_rate))
```

```{r, eval=FALSE}
  # total number 
  gases %>%
    nrow(.)

  # lod 
  gases %>%
    dplyr::filter(lod == "below") %>%
    nrow(.)
```

```{r}
  gases  %>%
    dplyr::select(-lod, -bg) %>%
    dplyr::arrange(pol, stove, fuel, id) %>%
    dplyr::rename("pollutant" = "pol",
                  "per-energy-delivered$^1$" = "energy_delivered_ef",
                  "per-time$^2$" = "emissions_rate",
                  "per-fuel-mass$^3$" = "mass_fuel_ef",
                  "per-fuel-energy$^4$" = "energy_fuel_ef") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("repeat_header", "striped"), font_size = 6) %>%
    footnote(general_title = "Notes: ", general = "Results reported to three significant figures; BB indicates a value below background; * indicates a value below the limit of detection; NA indicates a value with a measurement error", threeparttable = TRUE,
             number = c("g/MJ$_{delivered}$", "g/hour", "g/kg$_{fuel}$", "g/kJ$_{fuel}$"), escape = FALSE)
```

\newpage

## Organic carbon, organic matter, elemental carbon

```{r}
  oc_ec_om <-
    emissions %>%
    dplyr::filter(grepl("^oc$|^om$|^ec$", pol_category)) %>%
    dplyr::select(-pol_category, -pol)

  ids <-
    samples %>%
    dplyr::select(id) %>%
    dplyr::mutate(id = as.character(id)) %>%
    as_vector

  pols <-
    oc_ec_om %>%
    dplyr::select(pol_subcategory) %>%
    dplyr::distinct() %>%
    dplyr::mutate(pol_subcategory = as.character(pol_subcategory)) %>%
    as_vector

  cmpt <-
    expand.grid(pols, ids, stringsAsFactors = FALSE) %>%
    dplyr::rename("pol_subcategory" = "Var1",
                  "id" = "Var2") %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), 
                     by = "id")

  oc_ec_om <-
    oc_ec_om %>%
    dplyr::full_join(cmpt,
                     by = c("pol_subcategory", "id", "stove", "fuel")) %>%
    dplyr::mutate(energy_delivered_ef = signif(energy_delivered_ef, 3),
                  mass_fuel_ef = signif(mass_fuel_ef, 3),
                  energy_fuel_ef = signif(energy_fuel_ef, 3),
                  emissions_rate = signif(emissions_rate, 3),
                  energy_delivered_ef = as.character(energy_delivered_ef),
                  mass_fuel_ef = as.character(mass_fuel_ef),
                  energy_fuel_ef = as.character(energy_fuel_ef),
                  emissions_rate = as.character(emissions_rate)) %>%
    dplyr::mutate(energy_delivered_ef = ifelse(lod == "below", paste0(energy_delivered_ef, "*"), energy_delivered_ef),
                  mass_fuel_ef = ifelse(lod == "below", paste0(mass_fuel_ef, "*"), mass_fuel_ef),
                  energy_fuel_ef = ifelse(lod == "below", paste0(energy_fuel_ef, "*"), energy_fuel_ef),
                  emissions_rate = ifelse(lod == "below", paste0(emissions_rate, "*"), emissions_rate),
                  energy_delivered_ef = ifelse(bg == "below", "BB", energy_delivered_ef),
                  mass_fuel_ef = ifelse(bg == "below", "BB", mass_fuel_ef ),
                  energy_fuel_ef = ifelse(bg == "below", "BB", energy_fuel_ef),
                  emissions_rate = ifelse(bg == "below", "BB", emissions_rate))
```

```{r, eval=FALSE}
  # total number 
  oc_ec_om %>%
    nrow(.)

  # lod 
  oc_ec_om %>%
    dplyr::filter(lod == "below") %>%
    nrow(.)
```

```{r}
  oc_ec_om %>%
    dplyr::select(-lod, -bg) %>%
    dplyr::arrange(pol_subcategory, stove, fuel, id) %>%
    dplyr::rename("pollutant" = "pol_subcategory",
                  "per-energy-delivered$^1$" = "energy_delivered_ef",
                  "per-time$^2$" = "emissions_rate",
                  "per-fuel-mass$^3$" = "mass_fuel_ef",
                  "per-fuel-energy$^4$" = "energy_fuel_ef") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("repeat_header", "striped"), font_size = 6) %>%
    footnote(general_title = "Notes: ", general = "Results reported to three significant figures; BB indicates a value below background; * indicates a value below the limit of detection; NA indicates a value with a measurement error", threeparttable = TRUE,
             number = c("mg/MJ$_{delivered}$", "mg/hour", "mg/kg$_{fuel}$", "mg/kJ$_{fuel}$"), escape = FALSE)
```

\newpage

## Inorganic ions

```{r}
  ions <-
    emissions %>%
    dplyr::filter(grepl("ions", pol_category)) %>%
    dplyr::select(-pol_category, -pol_subcategory)

  ids <-
    samples %>%
    dplyr::select(id) %>%
    dplyr::mutate(id = as.character(id)) %>%
    as_vector

  pols <-
    ions %>%
    dplyr::select(pol) %>%
    dplyr::distinct() %>%
    dplyr::mutate(pol = as.character(pol)) %>%
    as_vector

  cmpt <-
    expand.grid(pols, ids, stringsAsFactors = FALSE) %>%
    dplyr::rename("pol" = "Var1",
                  "id" = "Var2") %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), 
                     by = "id")

  ions <-
    ions %>%
    dplyr::full_join(cmpt,
                     by = c("pol", "id", "stove", "fuel")) %>%
    dplyr::mutate(energy_delivered_ef = signif(energy_delivered_ef, 3),
                  mass_fuel_ef = signif(mass_fuel_ef, 3),
                  energy_fuel_ef = signif(energy_fuel_ef, 3),
                  emissions_rate = signif(emissions_rate, 3),
                  energy_delivered_ef = as.character(energy_delivered_ef),
                  mass_fuel_ef = as.character(mass_fuel_ef),
                  energy_fuel_ef = as.character(energy_fuel_ef),
                  emissions_rate = as.character(emissions_rate)) %>%
    dplyr::mutate(energy_delivered_ef = ifelse(lod == "below", paste0(energy_delivered_ef, "*"), energy_delivered_ef),
                  mass_fuel_ef = ifelse(lod == "below", paste0(mass_fuel_ef, "*"), mass_fuel_ef),
                  energy_fuel_ef = ifelse(lod == "below", paste0(energy_fuel_ef, "*"), energy_fuel_ef),
                  emissions_rate = ifelse(lod == "below", paste0(emissions_rate, "*"), emissions_rate),
                  energy_delivered_ef = ifelse(bg == "below", "BB", energy_delivered_ef),
                  mass_fuel_ef = ifelse(bg == "below", "BB", mass_fuel_ef ),
                  energy_fuel_ef = ifelse(bg == "below", "BB", energy_fuel_ef),
                  emissions_rate = ifelse(bg == "below", "BB", emissions_rate))
```

```{r, eval=FALSE}
  # total number 
  ions %>%
    nrow(.)

  # lod 
  ions %>%
    dplyr::filter(lod == "below") %>%
    nrow(.)
```

```{r}
  ions %>%
    dplyr::select(-lod, -bg) %>%
    dplyr::arrange(pol, stove, fuel, id) %>%
    dplyr::rename("pollutant" = "pol",
                  "per-energy-delivered$^1$" = "energy_delivered_ef",
                  "per-time$^2$" = "emissions_rate",
                  "per-fuel-mass$^3$" = "mass_fuel_ef",
                  "per-fuel-energy$^4$" = "energy_fuel_ef") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("repeat_header", "striped"), font_size = 6) %>%
    footnote(general_title = "Notes: ", general = "Results reported to three significant figures; BB indicates a value below background; * indicates a value below the limit of detection; NA indicates a value with a measurement error", threeparttable = TRUE,
             number = c("mg/MJ$_{delivered}$", "mg/hour", "mg/kg$_{fuel}$", "mg/kJ$_{fuel}$"), escape = FALSE)
```

\newpage

## Ultrafine particles

```{r}
  ufp <-
    emissions %>%
    dplyr::filter(grepl("ultrafine", pol)) %>%
    dplyr::select(-pol_category, -pol)

  ids <-
    samples %>%
    dplyr::select(id) %>%
    dplyr::mutate(id = as.character(id)) %>%
    as_vector

  pols <-
    ufp %>%
    dplyr::select(pol_subcategory) %>%
    dplyr::distinct() %>%
    dplyr::mutate(pol_subcategory = as.character(pol_subcategory)) %>%
    as_vector

  cmpt <-
    expand.grid(pols, ids, stringsAsFactors = FALSE) %>%
    dplyr::rename("pol_subcategory" = "Var1",
                  "id" = "Var2") %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), 
                     by = "id")

  ufp <-
    ufp %>%
    dplyr::full_join(cmpt,
                     by = c("pol_subcategory", "id", "stove", "fuel")) %>%
    dplyr::mutate(energy_delivered_ef = signif(energy_delivered_ef, 3),
                  mass_fuel_ef = signif(mass_fuel_ef, 3),
                  energy_fuel_ef = signif(energy_fuel_ef, 3),
                  emissions_rate = signif(emissions_rate, 3),
                  energy_delivered_ef = as.character(energy_delivered_ef),
                  mass_fuel_ef = as.character(mass_fuel_ef),
                  energy_fuel_ef = as.character(energy_fuel_ef),
                  emissions_rate = as.character(emissions_rate)) %>%
    dplyr::mutate(energy_delivered_ef = ifelse(bg == "below", "BB", energy_delivered_ef),
                  mass_fuel_ef = ifelse(bg == "below", "BB", mass_fuel_ef ),
                  energy_fuel_ef = ifelse(bg == "below", "BB", energy_fuel_ef),
                  emissions_rate = ifelse(bg == "below", "BB", emissions_rate))
```

```{r, eval=FALSE}
  # total number 
  ufp %>%
    nrow(.)

  # lod 
  ufp %>%
    dplyr::filter(lod == "below") %>%
    nrow(.)
```

```{r}
  ufp  %>%
    dplyr::select(-lod, -bg) %>%
    dplyr::arrange(pol_subcategory, stove, fuel, id) %>%
    dplyr::rename("pollutant" = "pol_subcategory",
                  "per-energy-delivered$^1$" = "energy_delivered_ef",
                  "per-time$^2$" = "emissions_rate",
                  "per-fuel-mass$^3$" = "mass_fuel_ef",
                  "per-fuel-energy$^4$" = "energy_fuel_ef") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("repeat_header", "striped"), font_size = 6) %>%
    footnote(general_title = "Notes: ", general = "Results reported to three significant figures; BB indicates a value below background; NA indicates a value with a measurement error", threeparttable = TRUE,
             number = c("particles/MJ$_{delivered}$", "particles/hour", "particles/kg$_{fuel}$", "particles/kJ$_{fuel}$"), escape = FALSE)
```

\newpage

## Volatile organic compounds

```{r}
  vocs <-
    emissions %>%
    dplyr::filter(grepl("vocs", pol_category)) %>%
    dplyr::select(-pol_category)

  ids <-
    samples %>%
    dplyr::select(id) %>%
    dplyr::mutate(id = as.character(id)) %>%
    as_vector

  pols <-
    vocs %>%
    dplyr::select(pol) %>%
    dplyr::distinct() %>%
    dplyr::mutate(pol = as.character(pol)) %>%
    as_vector

  cmpt <-
    expand.grid(pols, ids, stringsAsFactors = FALSE) %>%
    dplyr::rename("pol" = "Var1",
                  "id" = "Var2") %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), 
                     by = "id") %>%
    dplyr::mutate(pol_subcategory =
                    forcats::fct_collapse(pol,
                                          "alkanes" = c("ethane", "propane",
                                                        "i-butane", "n-butane",
                                                        "i-pentane", "n-pentane",
                                                        "n-hexane", "2,4-dimethylpentane",
                                                        "n-heptane", "3-methylpentane",
                                                        "2,3-dimethylpentane", "2-methylhexane",
                                                        "3-methylhexane", "2,2,4-trimethylpentane",
                                                        "2,3,4-trimethylpentane",
                                                        "2-methylheptane", "3-methylheptane",
                                                        "n-octane", "n-nonane", "n-decane"),
                                          "alkenes" = c("ethene", "propene",
                                                        "t,2-butene", "1-butene",
                                                        "i-butene", "c,2-butene",
                                                        "t,2-pentene", "2-methyl-2-butene",
                                                        "1-pentene", "c,2-pentene",
                                                        "isoprene", "1-hexene",
                                                        "c,2-hexene", "alpha-pinene"),
                                          "alkynes" = c("ethyne"),
                                          "aromatics" = c("cyclopentane", "cyclohexane",
                                                          "methylcyclohexane", "benzene",
                                                          "toluene", "ethylbenzene",
                                                          "m,p-xylene", "styrene",
                                                          "o-xylene", "i-propylbenzene",
                                                          "n-propylbenzene", "3-ethyltoluene",
                                                          "4-ethyltoluene", "1,3,5-trimethylbenzene",
                                                          "2-ethyltoluene", "1,2,4-trimethylbenzene",
                                                          "1,2,3-trimethylbenzene",
                                                          "1,3-diethylbenzene",
                                                          "1,4-diethylbenzene",
                                                          "1,2-diethylbenzene")))

  vocs <-
    vocs %>%
    dplyr::full_join(cmpt,
                     by = c("pol", "pol_subcategory", "id", "stove", "fuel")) %>%
    dplyr::mutate(energy_delivered_ef = signif(energy_delivered_ef, 3),
                  mass_fuel_ef = signif(mass_fuel_ef, 3),
                  energy_fuel_ef = signif(energy_fuel_ef, 3),
                  emissions_rate = signif(emissions_rate, 3),
                  energy_delivered_ef = as.character(energy_delivered_ef),
                  mass_fuel_ef = as.character(mass_fuel_ef),
                  energy_fuel_ef = as.character(energy_fuel_ef),
                  emissions_rate = as.character(emissions_rate)) %>%
    dplyr::mutate(energy_delivered_ef = ifelse(lod == "below", paste0(energy_delivered_ef, "*"), energy_delivered_ef),
                  mass_fuel_ef = ifelse(lod == "below", paste0(mass_fuel_ef, "*"), mass_fuel_ef),
                  energy_fuel_ef = ifelse(lod == "below", paste0(energy_fuel_ef, "*"), energy_fuel_ef),
                  emissions_rate = ifelse(lod == "below", paste0(emissions_rate, "*"), emissions_rate),
                  energy_delivered_ef = ifelse(bg == "below", "BB", energy_delivered_ef),
                  mass_fuel_ef = ifelse(bg == "below", "BB", mass_fuel_ef ),
                  energy_fuel_ef = ifelse(bg == "below", "BB", energy_fuel_ef),
                  emissions_rate = ifelse(bg == "below", "BB", emissions_rate))
```

```{r, eval=FALSE}
  # total number 
  vocs %>%
    nrow(.)

  # lod 
  vocs %>%
    dplyr::filter(lod == "below") %>%
    nrow(.)
```

```{r}
  vocs  %>%
    dplyr::select(-lod, -bg) %>%
    dplyr::arrange(pol_subcategory, pol, stove, fuel, id) %>%
    dplyr::rename("subcategory" = "pol_subcategory",
                  "pollutant" = "pol",
                  "per-energy-delivered$^1$" = "energy_delivered_ef",
                  "per-time$^2$" = "emissions_rate",
                  "per-fuel-mass$^3$" = "mass_fuel_ef",
                  "per-fuel-energy$^4$" = "energy_fuel_ef") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("repeat_header", "striped"), font_size = 5) %>%
    footnote(general_title = "Notes: ", general = "Results reported to three significant figures; BB indicates a value below background; * indicates a value below the limit of detection; NA indicates a value with a measurement error", threeparttable = TRUE,
             number = c("mg/MJ$_{delivered}$", "mg/hour", "mg/kg$_{fuel}$", "mg/kJ$_{fuel}$"), escape = FALSE)
```

\newpage

## Carbonyl compounds

```{r}
  carbs <-
    emissions %>%
    dplyr::filter(grepl("carbonyls", pol_category)) %>%
    dplyr::select(-pol_category)

  ids <-
    samples %>%
    dplyr::select(id) %>%
    dplyr::mutate(id = as.character(id)) %>%
    as_vector

  pols <-
    carbs %>%
    dplyr::select(pol) %>%
    dplyr::distinct() %>%
    dplyr::mutate(pol = as.character(pol)) %>%
    as_vector

  cmpt <-
    expand.grid(pols, ids, stringsAsFactors = FALSE) %>%
    dplyr::rename("pol" = "Var1",
                  "id" = "Var2") %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), 
                     by = "id") %>%
    dplyr::mutate(pol_subcategory =
                    forcats::fct_collapse(pol,
                                          "saturated aldehydes" = c("formaldehyde", "acetaldehyde",
                                                                    "propionaldehyde", "butyraldehyde",
                                                                    "valeraldehyde", "hexaldehyde"),
                                          "ketones" = c("acetone", "butanone", "isovaleraldehyde"),
                                          "unsaturated aldehydes" = c("acrolein", "crotonaldehyde", "methacrolein"),
                                          "aromatic aldehydes" = c("benzaldehyde", "o-tolualdehyde",
                                                                   "m,p-tolualdehyde", "2,5-dimethylbenzaldehyde")))

  carbs <-
    carbs %>%
    dplyr::full_join(cmpt,
                     by = c("pol", "pol_subcategory", "id", "stove", "fuel")) %>%
    dplyr::mutate(energy_delivered_ef = signif(energy_delivered_ef, 3),
                  mass_fuel_ef = signif(mass_fuel_ef, 3),
                  energy_fuel_ef = signif(energy_fuel_ef, 3),
                  emissions_rate = signif(emissions_rate, 3),
                  energy_delivered_ef = as.character(energy_delivered_ef),
                  mass_fuel_ef = as.character(mass_fuel_ef),
                  energy_fuel_ef = as.character(energy_fuel_ef),
                  emissions_rate = as.character(emissions_rate)) %>%
    dplyr::mutate(energy_delivered_ef = ifelse(lod == "below", paste0(energy_delivered_ef, "*"), energy_delivered_ef),
                  mass_fuel_ef = ifelse(lod == "below", paste0(mass_fuel_ef, "*"), mass_fuel_ef),
                  energy_fuel_ef = ifelse(lod == "below", paste0(energy_fuel_ef, "*"), energy_fuel_ef),
                  emissions_rate = ifelse(lod == "below", paste0(emissions_rate, "*"), emissions_rate),
                  energy_delivered_ef = ifelse(bg == "below", "BB", energy_delivered_ef),
                  mass_fuel_ef = ifelse(bg == "below", "BB", mass_fuel_ef ),
                  energy_fuel_ef = ifelse(bg == "below", "BB", energy_fuel_ef),
                  emissions_rate = ifelse(bg == "below", "BB", emissions_rate))
```

```{r, eval=FALSE}
  # total number 
  carbs %>%
    nrow(.)

  # lod 
  carbs %>%
    dplyr::filter(lod == "below") %>%
    nrow(.)
```

```{r}
  carbs %>%
    dplyr::select(-lod, -bg) %>%
    dplyr::arrange(pol_subcategory, pol, stove, fuel, id) %>%
    dplyr::rename("subcategory" = "pol_subcategory",
                  "pollutant" = "pol",
                  "per-energy-delivered$^1$" = "energy_delivered_ef",
                  "per-time$^2$" = "emissions_rate",
                  "per-fuel-mass$^3$" = "mass_fuel_ef",
                  "per-fuel-energy$^4$" = "energy_fuel_ef") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("repeat_header", "striped"),
                  font_size = 5) %>%
    footnote(general_title = "Notes: ", general = "Results reported to three significant figures; BB indicates a value below background; * indicates a value below the limit of detection; NA indicates a value with a measurement error", threeparttable = TRUE,
             number = c("mg/MJ$_{delivered}$", "mg/hour", "mg/kg$_{fuel}$", "mg/kJ$_{fuel}$"), escape = FALSE)
```

\newpage

## Polycyclic Aromatic Hydrocarbons

```{r}
  pahs <-
    emissions %>%
    dplyr::filter(grepl("pahs", pol_category)) %>%
    dplyr::select(-pol_category)  %>%
    dplyr::filter(pol != "cyclopenta[ce]phenanthrylene")

  ids <-
    samples %>%
    dplyr::select(id) %>%
    dplyr::mutate(id = as.character(id)) %>%
    as_vector

  pols <-
    pahs %>%
    dplyr::select(pol) %>%
    dplyr::distinct() %>%
    dplyr::mutate(pol = as.character(pol)) %>%
    as_vector

  cmpt <-
    expand.grid(pols, ids, stringsAsFactors = FALSE) %>%
    dplyr::rename("pol" = "Var1",
                  "id" = "Var2") %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), 
                     by = "id") %>%
    dplyr::mutate(pol_subcategory =
                    forcats::fct_collapse(pol,
                                          "two rings" = c("napthalene"),
                                          "three rings" = c("anthracene", "fluorene",
                                                            "phenanthene"),
                                          "four rings" = c("acephenanthrylene", "b[a]pyrene",
                                                           "benz[a]anthracene", "benzo[c]phenanthrene",
                                                           "chrysene and triphenylene", "pyrene",
                                                           "fluoranthene"),
                                          "five rings" = c("b[b]fluoranthene", "b[e]pyrene", "b[k]fluoranthene",
                                                           "b[j]fluoranthene", "benzo[ghi]fluoranthene",
                                                           "cyclopenta[cd]pyrene", "dibenzo(ah)anthracene",
                                                           "perylene"),
                                          "six rings" = c("benzo(ghi)perylene", "indeno(1,2,3) cd pyrene")))

  pahs <-
    pahs %>%
    dplyr::full_join(cmpt,
                     by = c("pol", "pol_subcategory", "id", "stove", "fuel")) %>%
    dplyr::mutate(energy_delivered_ef = signif(energy_delivered_ef, 3),
                  mass_fuel_ef = signif(mass_fuel_ef, 3),
                  energy_fuel_ef = signif(energy_fuel_ef, 3),
                  emissions_rate = signif(emissions_rate, 3),
                  energy_delivered_ef = as.character(energy_delivered_ef),
                  mass_fuel_ef = as.character(mass_fuel_ef),
                  energy_fuel_ef = as.character(energy_fuel_ef),
                  emissions_rate = as.character(emissions_rate)) %>%
    dplyr::mutate(energy_delivered_ef = ifelse(lod == "below", paste0(energy_delivered_ef, "*"), energy_delivered_ef),
                  mass_fuel_ef = ifelse(lod == "below", paste0(mass_fuel_ef, "*"), mass_fuel_ef),
                  energy_fuel_ef = ifelse(lod == "below", paste0(energy_fuel_ef, "*"), energy_fuel_ef),
                  emissions_rate = ifelse(lod == "below", paste0(emissions_rate, "*"), emissions_rate),
                  energy_delivered_ef = ifelse(bg == "below", "BB", energy_delivered_ef),
                  mass_fuel_ef = ifelse(bg == "below", "BB", mass_fuel_ef ),
                  energy_fuel_ef = ifelse(bg == "below", "BB", energy_fuel_ef),
                  emissions_rate = ifelse(bg == "below", "BB", emissions_rate))
```

```{r, eval=FALSE}
  # total number 
  pahs %>%
    nrow(.)

  # lod 
  pahs %>%
    dplyr::filter(lod == "below") %>%
    nrow(.)
```

```{r}
  pahs %>%
    dplyr::select(-lod, -bg) %>%
    dplyr::arrange(pol_subcategory, pol, stove, fuel, id) %>%
    dplyr::rename("subcategory" = "pol_subcategory",
                  "pollutant" = "pol",
                  "per-energy-delivered$^1$" = "energy_delivered_ef",
                  "per-time$^2$" = "emissions_rate",
                  "per-fuel-mass$^3$" = "mass_fuel_ef",
                  "per-fuel-energy$^4$" = "energy_fuel_ef") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("repeat_header", "striped"),
                  font_size = 5) %>%
    footnote(general_title = "Notes: ", general = "Results reported to three significant figures; BB indicates a value below background; * indicates a value below the limit of detection; NA indicates a value with a measurement error", threeparttable = TRUE,
             number = c("mg/MJ$_{delivered}$", "mg/hour", "mg/kg$_{fuel}$", "mg/kJ$_{fuel}$"), escape = FALSE)
```

\newpage

## Carbohydrates

```{r}
  sugars <-
    emissions %>%
    dplyr::filter(grepl("carbohydrates", pol_category)) %>%
    dplyr::select(-pol_category, -pol_subcategory)

  ids <-
    samples %>%
    dplyr::select(id) %>%
    dplyr::mutate(id = as.character(id)) %>%
    as_vector

  pols <-
    sugars %>%
    dplyr::select(pol) %>%
    dplyr::distinct() %>%
    dplyr::mutate(pol = as.character(pol)) %>%
    as_vector

  cmpt <-
    expand.grid(pols, ids, stringsAsFactors = FALSE) %>%
    dplyr::rename("pol" = "Var1",
                  "id" = "Var2") %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), 
                     by = "id")

  sugars <-
    sugars %>%
    dplyr::full_join(cmpt,
                     by = c("pol", "id", "stove", "fuel")) %>%
    dplyr::mutate(energy_delivered_ef = signif(energy_delivered_ef, 3),
                  mass_fuel_ef = signif(mass_fuel_ef, 3),
                  energy_fuel_ef = signif(energy_fuel_ef, 3),
                  emissions_rate = signif(emissions_rate, 3),
                  energy_delivered_ef = as.character(energy_delivered_ef),
                  mass_fuel_ef = as.character(mass_fuel_ef),
                  energy_fuel_ef = as.character(energy_fuel_ef),
                  emissions_rate = as.character(emissions_rate)) %>%
    dplyr::mutate(energy_delivered_ef = ifelse(lod == "below", paste0(energy_delivered_ef, "*"), energy_delivered_ef),
                  mass_fuel_ef = ifelse(lod == "below", paste0(mass_fuel_ef, "*"), mass_fuel_ef),
                  energy_fuel_ef = ifelse(lod == "below", paste0(energy_fuel_ef, "*"), energy_fuel_ef),
                  emissions_rate = ifelse(lod == "below", paste0(emissions_rate, "*"), emissions_rate),
                  energy_delivered_ef = ifelse(bg == "below", "BB", energy_delivered_ef),
                  mass_fuel_ef = ifelse(bg == "below", "BB", mass_fuel_ef ),
                  energy_fuel_ef = ifelse(bg == "below", "BB", energy_fuel_ef),
                  emissions_rate = ifelse(bg == "below", "BB", emissions_rate))
```

```{r, eval=FALSE}
  # total number 
  sugars %>%
    nrow(.)

  # lod 
  sugars %>%
    dplyr::filter(lod == "below") %>%
    nrow(.)
```

```{r}
  sugars %>%
    dplyr::select(-lod, -bg) %>%
    dplyr::arrange(pol, stove, fuel, id) %>%
    dplyr::rename("pollutant" = "pol",
                  "per-energy-delivered$^1$" = "energy_delivered_ef",
                  "per-time$^2$" = "emissions_rate",
                  "per-fuel-mass$^3$" = "mass_fuel_ef",
                  "per-fuel-energy$^4$" = "energy_fuel_ef") %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE) %>%
    kable_styling(position = "center", latex_options = c("repeat_header", "striped"), font_size = 6) %>%
    footnote(general_title = "Notes: ", general = "Results reported to three significant figures; BB indicates a value below background; * indicates a value below the limit of detection; NA indicates a value with a measurement error", threeparttable = TRUE,
             number = c("mg/MJ$_{delivered}$", "mg/hour", "mg/kg$_{fuel}$", "mg/kJ$_{fuel}$"), escape = FALSE)
```