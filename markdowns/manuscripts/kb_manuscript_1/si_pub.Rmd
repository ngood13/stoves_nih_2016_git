---
title: "SUPPORTING INFORMATION"
geometry: margin=0.75in
output:
  pdf_document:
    toc: false
---

```{r load_libraries, echo=FALSE, message=FALSE}
  if (!require("pacman")) install.packages("pacman")
  pacman::p_load(tidyverse, patchwork, knitr, kableExtra, forcats,
                 RColorBrewer, stringi, pBrackets)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path='figures/', warning=FALSE, message=FALSE, cache=FALSE, echo=FALSE)
```

```{r, echo=FALSE}
  emissions <- readRDS("../../../r_data/emissions_factors.RDS")
  missing_stoves <- readRDS("../../../r_data/model_info.RDS")
  fuel_burnt <- readRDS("../../../r_data/fuel_merged.RDS")
  times <- readRDS("../../../r_data/test_times.RDS")
  samples <- readRDS("../../../r_data/samples.RDS")
  fuels <- readRDS("../../../r_data/fuel_properties.RDS")
  pol_properties <- readRDS("../../../r_data/pol_properties.RDS")
```

```{r, echo=FALSE}
  samples <-
    samples %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    factor %>% 
                    forcats::fct_relevel("three-stone fire",
                                         "chulha",
                                         "rocket elbow",
                                         "built-in plancha",
                                         "fan rocket-elbow",
                                         "forced-draft gasifier",
                                         "ceramic charcoal",
                                         "metal charcoal",
                                         "wick kerosene",
                                         "pressure kerosene",
                                         "lpg") %>%
                    forcats::fct_recode("Three-stone fire" = "three-stone fire",
                                         "Mud chulha" = "chulha",
                                         "Rocket elbow" = "rocket elbow",
                                         "Built-in plancha" = "built-in plancha",
                                         "Fan rocket elbow" = "fan rocket-elbow",
                                         "Gasifier" = "forced-draft gasifier",
                                         "Ceramic jiko" = "ceramic charcoal",
                                          "Metal jiko" = "metal charcoal",
                                          "Wick kerosene" = "wick kerosene",
                                         "Pressure kerosene" = "pressure kerosene",
                                          "LPG" = "lpg"))
```

```{r}
  emissions <-
    emissions %>%
    dplyr::filter(pol != "cyclopenta[ce]phenanthrylene")
```

\begin{center}
\LARGE{Household Cookstoves: A Comprehensive Laboratory Assessment of Air Pollutant Emissions}
\end{center}

Kelsey R. Bilsback, Jordyn Dahlke, Kristen Fedak, Nicholas Good, Arsineh Hecobian, Pierre Herckes, Christian L’Orange, John Mehaffy, Amy Sullivan, Jessica Tryner, Lizette Van Zyl, Ethan Walker, Ander Wilson, Jennifer L. Peel, John Volckens

\tableofcontents
\newpage

# SI 1: Stove type information

Make and model of each stove type.

```{r}
  tibble::data_frame("Stove type" = c("Three-stone fire",
                                      "Mud chulha",
                                      "Rocket elbow",
                                      "Built-in plancha (with chimney)",
                                      "Fan rocket-elbow",
                                      "Forced-draft gasifier",
                                      "Ceramic jiko",
                                      "Metal jiko",
                                      "Wick kerosene",
                                      "Pressurized kerosene",
                                      "Liquefied petroleum gas (LPG) stove"),
                     "Stove make" = c("Artisan",
                                "Artisan",
                                "Envirofit",
                                "Envirofit",
                                "Biolite",
                                "Philips",
                                "Artisan",
                                "BURN",
                                "Cook 'n Lite",
                                "Butterfly",
                                "WokSmith"),
                     "Stove model" = c("Artisan",
                                "Artisan",
                                "G3300",
                                "HM5000",
                                "Homestove$^1$",
                                "HD4012",
                                "Artisan",
                                "jikokoa",
                                "82",
                                "2412",
                                "WS-C1-25K")) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c',
          linesep = "") %>%
    kable_styling(latex_options = c("striped"), position = "center", font_size = 10)
```

# SI 2: Fuel use by stove type

Fuel use, during the emissions sample, by stove type, where the mean and range of are indicated by the point markers and lines, respectively.

```{r}
  fuel_burnt %>%
    dplyr::left_join(dplyr::select(samples, id, stove), by = "id") %>%
    dplyr::group_by(stove) %>%
    dplyr::summarise(fuel_mass = mean(mass_fuel_comb, na.rm = TRUE),
                     min = min(mass_fuel_comb, na.rm = TRUE),
                     max = max(mass_fuel_comb, na.rm = TRUE)) %>%
    dplyr::mutate(stove = forcats::fct_rev(stove)) %>%
    ggplot(aes(x = stove, y = fuel_mass)) +
      geom_point(size = 2) +
      geom_errorbar(aes(ymin = min, ymax = max), width = 0) +
      coord_flip() +
      theme_bw() +
      theme(text = element_text(size = 12),
            axis.title.y = element_blank()) +
      ylab("Fuel burned (grams)")
```

\newpage

# SI 3: Emissions measurement duration by stove type

Emissions measurement duration by stove type, where the mean and range are indicated by the point markers and lines, respectively.

```{r}
  test_duration <-
    times %>%
      dplyr::filter(var == "sample" | var == "refuel_1" | var == "shutdown") %>%
      dplyr::mutate(var = as.character(var),
                    var = ifelse(var == "refuel_1", "sample", var)) %>%
      tidyr::spread(var, value) %>%
      dplyr::mutate(duration = (shutdown - sample) / 60)

  test_duration %>%
    dplyr::left_join(dplyr::select(samples, id, stove), by = "id") %>%
    dplyr::group_by(stove) %>%
    dplyr::filter(!grepl("^27|^28|^29|^30", id)) %>%
    dplyr::summarise(dur = mean(duration, na.rm = TRUE),
                     min = min(duration, na.rm = TRUE),
                     max = max(duration, na.rm = TRUE)) %>%
    dplyr::mutate(stove = forcats::fct_rev(stove)) %>%
    ggplot(aes(x = stove, y = dur)) +
      geom_point(size = 2) +
      geom_errorbar(aes(ymin = min, ymax = max), width = 0) +
      coord_flip() +
      theme_bw() +
      theme(text = element_text(size = 12),
            axis.title.y = element_blank()) +
      ylab("Test duration (minutes)")
```

\newpage

# SI 4: Test-averaged firepower by stove type

Average firepower, during the emissions sample, by stove type, where the mean and range of are indicated by the point markers and lines, respectively. The sample-averaged firepower was calculated using the average fuel burn rate (SI 2 & SI 3) and the lower heating value of the fuel (SI 13).

```{r}
  fuel_burnt %>%
    dplyr::left_join(dplyr::select(samples, id, stove), by = "id") %>%
    dplyr::left_join(test_duration, by = "id") %>%
    dplyr::mutate(fp = lhv * ((mass_fuel_comb / 1000) / (duration * 60))) %>%
    dplyr::group_by(stove) %>%
    dplyr::summarise(firepower = mean(fp, na.rm = TRUE),
                     min = min(fp, na.rm = TRUE),
                     max = max(fp, na.rm = TRUE)) %>%
    dplyr::mutate(stove = forcats::fct_rev(stove)) %>%
    ggplot(aes(x = stove, y = firepower)) +
      geom_point(size = 2) +
      geom_errorbar(aes(ymin = min, ymax = max), width = 0) +
      coord_flip() +
      theme_bw() +
      theme(text = element_text(size = 12),
            axis.title.y = element_blank()) +
      ylab("Firepower (kilowatts)")
```

\newpage

# SI 5: Test setup and emissions measurement

## SI 5.1: Test setup

Schematic of the testing setup. See SI 5.2 and SI 5.3 for details about the sampling media and analysis instrumentation.

```{r, echo=FALSE, out.height = '85%', fig.align='center'}
  knitr::include_graphics("images/schematic.pdf")
```

## SI 5.2: Emissions measurement

Information about the sampling media and analysis instrumentation used to measure each cookstove smoke constituent. See SI 5.1 for instrumentation schematic.

```{r}
  tibble::data_frame("Smoke constituent" = c("Fine particulate matter",
                                     "Organic carbon, elemental carbon, and organic carbon absorption artifact",
                                     "Speciated inorganic anions",
                                     "Speciated inorganic cations",
                                     "Speciated polycyclic aromatic hydrocarbons (particle phase)",
                                     "Speciated polycyclic aromatic hydrocarbons (gas phase)",
                                     "Speciated carbohydrates",
                                     "Speciated volatile organic compounds",
                                     "Speciated aldehydes and ketones",
                                     "Ultrafine particles",
                                     "Carbon dioxide, carbon monoxide, and methane"),
                     "Sampling media" = c("46.2 mm, 2 µm PTFE PM2.5 Air Monitoring Membrane Filter; Tisch International; North Bend, OH",
                                          "Tissuquartz \\#2500QAT-UP; Pall Corporation; Port Washington, NY",
                                          "Tissuquartz \\#2500QAT-UP; Pall Corporation; Port Washington, NY",
                                          "Tissuquartz \\#2500QAT-UP; Pall Corporation; Port Washington, NY",
                                          "Tissuquartz \\#2500QAT-UP; Pall Corporation; Port Washington, NY",
                                          "PUF Replacement P226-92; SKC-West, Inc; Fullerton, CA (two inline)",
                                          "Tissuquartz \\#2500QAT-UP; Pall Corporation; Port Washington, NY",
                                          "Vacuum canister fitted with a critical orifice (CS1200ES Sampler; ENTECH Instruments, Inc.; Simi Valley, CA)",
                                          "Dinitrophenylhydrazine cartridge (Sep-Pak DNPH-Silica Cartridge; Waters Corp; Milford, MA) placed inline behind an ozone scrubber (Sep-Pak Ozone Scrubber Potassium Iodide Cartridge; Waters Corp; Milford, MA)",
                                          "",
                                          ""),
                     "Analysis instrumentation" = c("MX5 Microbalance; Mettler Toledo; Columbus, OH",
                                                    "OCEC Carbon Aerosol Analyzer 5L; Sunset Laboratory, Inc; Tigard, OR",
                                                    "DX-500 Ion Chromatography System; Dionex; Waltham, MA",
                                                    "CS-3000 Ion Chromatography System; Dionex; Waltham, MA",
                                                    "Agilent 6890/5973 Inert, Agilent Technologies, Santa Clara, CA",
                                                    "Agilent 6890/5973 Inert, Agilent Technologies, Santa Clara, CA",
                                                    "1260 Infinity; Agilent Technologies; Santa Clara, CA",
                                                    "Gas chromatograph mass spectrometer (GC-17A); Shimadzu; Kyoto, Japan",
                                                    "HPLC 1050 series; Agilent Technologies; Santa Clara, CA",
                                                    "Scanning Mobility Particle Sizer Spectrometer 3938, TSI Incorporated, Shoreview, Minnesota",
                                                    "ULTRAMAT/OXYMAT 6 and ULTRAMAT 23 (NDIR); Siemens; Munich, Germany"),
                     "Mesurement frequency" = c("Test integrated",
                                                "Test integrated",
                                                "Test integrated",
                                                "Test integrated",
                                                "Test integrated",
                                                "Test integrated",
                                                "Test integrated",
                                                "Test integrated",
                                                "Test integrated",
                                                "$\\sim$0.0055 hertz",
                                                "1.0 hertz")) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c',
          linesep = "", longtable = TRUE) %>%
    kable_styling(latex_options = c("striped"), position = "center", font_size = 8) %>%
    column_spec(1, width = "10em") %>%
    column_spec(2, width = "10em") %>%
    column_spec(3, width = "10em")
```

\newpage

## SI 5.3: Additional instrumentation

Instrumentation that was used for either quality control or as part of the test setup. See SI 5.1 for instrumentation schematic.

```{r}
  tibble::data_frame("Instrumentation" = c("Hot-wire anemometer",
                                           "Bubble flow meter",
                                           "Cyclone inlets",
                                           "Carbon dioxide sensors",
                                           "Thermocouple",
                                           "HEPA filters",
                                           "Needle valves",
                                           "Rotometers",
                                           "Diaphragm Pump"),
                     "Details" = c("Velometer AVM430-A; TSI Alnor; Huntington Beach, CA",
                                   "mini-Buck Calibrator M-30; A.P. Buck, Inc; Orlando, FL",
                                   "16.7 liters per minute, 2.5 µm cutpoint; URG; Chapel Hill, NC",
                                   "LI-820 CO2 Analyzer; LI-COR; Lincoln, NE",
                                   "K-type Thermocouple; OMEGA Engineering Inc.; Norwalk, CT",
                                   "HEPA Capsule Filter (HC10-4N-PTF - HEPA); Eta Filters; Minneapolis, MN",
                                   "High Flow Metering Valve (SS-4L/B-4L); Swagelok; Solon, OH",
                                   "Acrylic Flow Meters (FL-2041-SS); OMEGA Engineering Inc.; Norwalk, CT",
                                   "Oilless Diaphragm Pump (MOA-P109-CA); Gast; York, PA"),
                     "Purpose" = c("Hood flow rates (monitored throughout the study)",
                                   "Sample line flow rates (measured in triplicate before and after each test)",
                                   "Removing particles above 2.5 µm for filter-based measurements",
                                   "Measure dilution ratio of Venturi pump dilution system",
                                   "Measure water temperature and flame temperature",
                                   "Various (see SI 5.1)",
                                   "Various (see SI 5.1)",
                                   "Monitoring flow rates",
                                   "Various (see SI 5.1)")) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c',
          linesep = "") %>%
    kable_styling(latex_options = c("striped"), position = "center", font_size = 8) %>%
    column_spec(1, width = "10em") %>%
    column_spec(2, width = "15em") %>%
    column_spec(3, width = "15em")
```

\newpage

# SI 6: Cookstove smoke constituents

Cookstove smoke constituents with associated grouping category. List includes 121 constituents, because organic matter and organic carbon are listed seperately.

```{r}
  emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(!grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::select(pol_category, pol_subcategory, pol) %>%
    dplyr::distinct() %>%
    dplyr::mutate(pol = as.character(pol),
                  pol_subcategory = as.character(pol_subcategory),
                  pol_category = as.character(pol_category),
                  pol = ifelse(pol == "pm_mass", "PM$_{2.5}$", pol),
                  pol_subcategory = ifelse(pol_subcategory == "pm_mass", "", pol_subcategory),
                  pol_category = ifelse(pol_category == "pm_mass", "", pol_category),
                  pol = ifelse(pol == "ec", "elemental carbon", pol),
                  pol_subcategory = ifelse(pol_subcategory == "elemental carbon", "", pol_subcategory),
                  pol_category = ifelse(pol_category == "ec", "", pol_category),
                  pol = ifelse(pol == "om", "organic matter", pol),
                  pol_subcategory = ifelse(pol_subcategory == "organic matter", "", pol_subcategory),
                  pol_category = ifelse(pol_category == "om", "", pol_category),
                  pol = ifelse(pol == "oc", "organic carbon", pol),
                  pol_subcategory = ifelse(pol_subcategory == "organic carbon", "", pol_subcategory),
                  pol_category = ifelse(pol_category == "oc", "", pol_category),
                  pol = ifelse(grepl("^co2$", pol), "carbon dioxide", pol),
                  pol_subcategory = ifelse(grepl("^co2$", pol_subcategory), "", pol_subcategory),
                  pol_category = ifelse(grepl("^co2$", pol_category), "", pol_category),
                  pol_subcategory = ifelse(grepl("^co$", pol_subcategory), "", pol_subcategory),
                  pol_category = ifelse(grepl("^co$", pol_category), "", pol_category),
                  pol = ifelse(grepl("^co$", pol), "carbon monoxide", pol),
                  pol_subcategory = ifelse(grepl("^ch4$", pol_subcategory), "", pol_subcategory),
                  pol_category = ifelse(grepl("^ch4$", pol_category), "", pol_category),
                  pol = ifelse(grepl("^ch4$", pol), "methane", pol),
                  pol_subcategory = ifelse(grepl("^ions$", pol_subcategory), "inorganic ions", pol_subcategory),
                  pol_category = ifelse(grepl("^ions$", pol_category), "", pol_category),
                  pol_category = ifelse(grepl("^smps$", pol_category), "", pol_category),
                  pol = ifelse(grepl("ultrafines", pol), "ultrafine particles", pol),
                  pol_subcategory = ifelse(grepl("ultrafines", pol_subcategory), "", pol_subcategory),
                  pol_subcategory = gsub(" rings", " rings", pol_subcategory),
                  pol_category = gsub("pahs", "PAHs", pol_category),
                  pol_category = gsub("vocs", "VOCs", pol_category),
                  pol_category = gsub("carbonyls", "carbonyls", pol_category),
                  pol = ifelse(grepl("pinene", pol), "alpha-pinene", pol),
                  pol = ifelse(grepl("2_methyl_2_butene", pol), "2-methyl-2-butene", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([a-z])", "\\1-\\3", pol),
                  pol = gsub("([a-z])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("(m)(_)(p)", "\\1,\\3", pol),
                  pol = gsub("([a-z])(_)([a-z])", "\\1-\\3", pol),
                  pol_category = gsub("carbohydrates", "carbohydrates", pol_category)) %>%
    dplyr::select(pol, pol_subcategory, pol_category) %>%
    dplyr::arrange(pol) %>%
    dplyr::rename("Measurement grouping" = pol_category,
                  "Analysis grouping" = pol_subcategory,
                  "Smoke constituent" = pol) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', linesep = "", longtable = TRUE) %>%
    kable_styling(latex_options = c("striped"), position = "center", font_size = 8)
```

\newpage

# SI 7: Particle number penetration through the Venturi pump

Fraction of particles that penetrated the venturi pump (i.e., number penetration) at two different dilution ratios (DR). The venturi pump was upstream of the scanning mobility particle sizer and used to dilute the emissions sample. Although, there is substantial scatter at smaller particle sizes, these results suggest that the majority of particles lost in the Venturi pump are greater than 200 nm. Thus, the number concentration of ultrafines (particles less than 100 nm) will likely not be substantially affected by losses in the Venturi pump.

```{r, echo=FALSE, out.width = '100%'}
  knitr::include_graphics("images/num_penetration.png")
```

\newpage

# SI 8: Particle-phase emissions mass balance

PM$_{2.5}$ versus the sum of inorganic ions, elemental carbon, and organic matter. Error bars represent propagated uncertainty from the Sunset OCEC analyzer. The black line represent the equation $y = x$.

```{r, echo=FALSE, out.width = '75%', fig.align="center"}
  knitr::include_graphics("../../emissions_factors/figures/mass_balance-1.png")
```

\newpage

# SI 9: Carcinogenic compound classifications

```{r}
  tibble::data_frame("pollutant" = c("benzene",
                                    "formaldehyde",
                                    "styrene",
                                    "acetaldehyde",
                                    "isoprene",
                                    "benz[a]anthracene",
                                    "benzo[a]pyrene",
                                    "benzo[b]fluoranthene",
                                    "benzo[j]fluoranthene",
                                    "benzo[k]fluoranthene",
                                    "cyclopenta[cd]pyrene",
                                    "dibenzo[a,h]anthracene",
                                    "indeno[1,2,3-cd]pyrene"),
                     "phase" = c("gas",
                                 "gas",
                                 "gas",
                                 "gas",
                                 "gas",
                                 "particle",
                                 "particle",
                                 "particle",
                                 "particle",
                                 "particle",
                                 "particle",
                                 "particle",
                                 "particle"),
                     "NTP$^1$" = c("Known to be a human carcinogen",
                                   "Known to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "NA",
                                   "Reasonably anticipated to be a human carcinogen",
                                   "Reasonably anticipated to be a human carcinogen"),
                     "IARC$^2$" = c("Group 1: Carcinogenic to humans",
                                    "Group 1: Carcinogenic to humans",
                                    "Group 2A: Probably carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 1: Carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans",
                                    "Group 2A: Probably carcinogenic to humans",
                                    "Group 2A: Probably carcinogenic to humans",
                                    "Group 2B: Possibly carcinogenic to humans")) %>%
    kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c',
          linesep = "") %>%
    kable_styling(latex_options = c("striped"), position = "center", font_size = 8) %>%
    footnote(general_title = "Notes: ", threeparttable = TRUE,
             number = c("National Toxicology Program (NTP)",
                        "International Agency for Research on Cancer (IARC)"))
```

\newpage

# SI 10: Number of measurements by stove type

The number of per-energy-delivered emissions factors used in the analysis for each type of pollutant. The number of attempted measurements, by stove type, are listed in the footnote. See Figure q for breakdown by fuel type. Missing measurements are due to measurement issues or erroneous data. (The number of measurements include both measurements that were below the limit of detection or below the study-averaged laboratory background level.)

## SI 10.1: Wood stoves

```{r}
  three_stone <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Three-stone fire", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::rename("douglas" = "douglas fir") %>%
      dplyr::mutate(all =  oak + eucalyptus + douglas) %>%
      dplyr::ungroup() %>%
      dplyr::rename("Oak" = "oak",
                    "Eucalyptus" = "eucalyptus",
                    "Douglas fir" = "douglas",
                    "Total" = "all")

  mud_chulha <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Mud chulha", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::rename("douglas" = "douglas fir") %>%
      dplyr::mutate(all =  oak + eucalyptus + douglas) %>%
      dplyr::ungroup() %>%
      dplyr::rename("Oak" = "oak",
                    "Eucalyptus" = "eucalyptus",
                    "Douglas fir" = "douglas",
                    "Total" = "all")

  rocket <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Rocket elbow", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::rename("douglas" = "douglas fir") %>%
      dplyr::mutate(all =  oak + eucalyptus + douglas) %>%
      dplyr::ungroup() %>%
      dplyr::rename("Oak" = "oak",
                    "Eucalyptus" = "eucalyptus",
                    "Douglas fir" = "douglas",
                    "Total" = "all")

  plancha <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Built-in plancha", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::rename("douglas" = "douglas fir") %>%
      dplyr::mutate(all =  oak + eucalyptus + douglas) %>%
      dplyr::ungroup() %>%
      dplyr::rename("Oak" = "oak",
                    "Eucalyptus" = "eucalyptus",
                    "Douglas fir" = "douglas",
                    "Total" = "all")

  fan_rocket <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Fan rocket elbow", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::rename("douglas" = "douglas fir") %>%
      dplyr::mutate(all =  oak + eucalyptus + douglas) %>%
      dplyr::ungroup() %>%
      dplyr::rename("Oak" = "oak",
                    "Eucalyptus" = "eucalyptus",
                    "Douglas fir" = "douglas",
                    "Total" = "all")

    three_stone %>%
      dplyr::bind_cols(dplyr::select(mud_chulha, -pol_category)) %>%
      dplyr::bind_cols(dplyr::select(rocket, -pol_category)) %>%
      dplyr::bind_cols(dplyr::select(plancha, -pol_category)) %>%
      dplyr::bind_cols(dplyr::select(fan_rocket, -pol_category)) %>%
      dplyr::mutate(pol_category = as.character(pol_category),
                    pol_category = ifelse(pol_category == "pm_mass", "PM$_{2.5}$", pol_category),
                    pol_category = ifelse(pol_category == "ec", "elemental carbon", pol_category),
                    pol_category = ifelse(pol_category == "oc", "organic carbon", pol_category),
                    pol_category = ifelse(pol_category == "om", "organic mass", pol_category),
                    pol_category = ifelse(grepl("^co2$", pol_category), "carbon dioxide", pol_category),
                    pol_category = ifelse(grepl("^co$", pol_category), "carbon monoxide", pol_category),
                    pol_category = ifelse(grepl("^ch4$", pol_category), "methane", pol_category),
                    pol_category = ifelse(grepl("^ions$", pol_category), "inorganic ions", pol_category),
                    pol_category = ifelse(grepl("smps", pol_category), "ultrafine particles", pol_category),
                    pol_category = ifelse(grepl("pahs", pol_category), "PAHs", pol_category),
                    pol_category = ifelse(grepl("vocs", pol_category), "VOCs", pol_category)) %>%
      dplyr::rename(" " = "pol_category",
                    "Oak" = "Oak1",
                    "Eucalyptus" = "Eucalyptus1",
                    "Douglas fir" = "Douglas fir1",
                    "Total" = "Total1",
                    "Oak" = "Oak2",
                    "Eucalyptus" = "Eucalyptus2",
                    "Douglas fir" = "Douglas fir2",
                    "Total" = "Total2",
                    "Oak" = "Oak3",
                    "Eucalyptus" = "Eucalyptus3",
                    "Douglas fir" = "Douglas fir3",
                    "Total" = "Total3",
                    "Oak" = "Oak4",
                    "Eucalyptus" = "Eucalyptus4",
                    "Douglas fir" = "Douglas fir4",
                    "Total" = "Total4") %>%
      kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE,
            linesep = "") %>%
      kable_styling(latex_options = c("striped"), position = "center", font_size = 9) %>%
      footnote(number = c("Thirteen test replicates conducted", "Eleven test replicates conducted", "Ten test replicates conducted",
                         "Nine test replicates conducted", "Nine test replicates conducted"), escape = FALSE) %>%
      row_spec(0, angle = 90) %>%
      add_header_above(c(" ", "Three-stone fire$^1$" = 4, "Mud chulha$^2$" = 4, "Rocket elbow$^3$" = 4,
                         "Built-in plancha$^4$" = 4, "Fan rocket elbow$^5$" = 4), escape = FALSE) %>%
      column_spec(1, width = "10em")
```

\newpage

## SI 10.2: Pellet, charcoal, and fossil-fuel stoves

```{r}
  gasifier <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Gasifier", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::rename("l" = "west slope pellets",
                    "e" = "eucalyptus pellets") %>%
      dplyr::mutate(all =  l + e) %>%
      dplyr::ungroup() %>%
      dplyr::rename("Lodgepole pine pellets" = "l",
                    "Eucalyptus pellets" = "e",
                    "Total" = "all")
  ceramic <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Ceramic jiko", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::rename("m" = "lump hardwood (med.)",
                    "s" = "lump hardwood (sm.)",
                    "c" = "coconut charcoal") %>%
      dplyr::mutate(all =  m + s + c) %>%
      dplyr::ungroup() %>%
      dplyr::rename("Hardwood lumps (med.)" = "m",
                    "Hardwood lumps (sm.)" = "s",
                    "Coconut briquettes" = "c",
                    "Total" = "all") 

  metal <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Metal jiko", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::rename("m" = "lump hardwood (med.)",
                    "s" = "lump hardwood (sm.)",
                    "c" = "coconut charcoal") %>%
      dplyr::mutate(all =  m + s + c) %>%
      dplyr::ungroup() %>%
      dplyr::rename("Hardwood lumps (med.)" = "m",
                    "Hardwood lumps (sm.)" = "s",
                    "Coconut briquettes" = "c",
                    "Total" = "all") 

  wick <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Wick kerosene", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::ungroup() %>%
      dplyr::rename("Kerosene" = "kerosene")
  
  pressure <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Pressure kerosene", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::ungroup() %>%
      dplyr::rename("Kerosene" = "kerosene")

  lpg <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "LPG", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
      dplyr::group_by(pol_category, fuel) %>%
      dplyr::select(pol_category, id, fuel) %>%
      dplyr::distinct() %>%
      dplyr::summarise(n = n()) %>%
      tidyr::spread(fuel, n) %>%
      dplyr::ungroup() %>%
      dplyr::rename("LPG" = "lpg")

    gasifier %>%
      dplyr::bind_cols(dplyr::select(ceramic, -pol_category)) %>%
      dplyr::bind_cols(dplyr::select(metal, -pol_category)) %>%
      dplyr::bind_cols(dplyr::select(wick, -pol_category)) %>%
      dplyr::bind_cols(dplyr::select(pressure, -pol_category)) %>%
      dplyr::bind_cols(dplyr::select(lpg, -pol_category)) %>%
      dplyr::mutate(pol_category = as.character(pol_category),
                    pol_category = ifelse(pol_category == "pm_mass", "PM$_{2.5}$", pol_category),
                    pol_category = ifelse(pol_category == "ec", "elemental carbon", pol_category),
                    pol_category = ifelse(pol_category == "oc", "organic carbon", pol_category),
                    pol_category = ifelse(pol_category == "om", "organic mass", pol_category),
                    pol_category = ifelse(grepl("^co2$", pol_category), "carbon dioxide", pol_category),
                    pol_category = ifelse(grepl("^co$", pol_category), "carbon monoxide", pol_category),
                    pol_category = ifelse(grepl("^ch4$", pol_category), "methane", pol_category),
                    pol_category = ifelse(grepl("^ions$", pol_category), "inorganic ions", pol_category),
                    pol_category = ifelse(grepl("smps", pol_category), "ultrafine particles", pol_category),
                    pol_category = ifelse(grepl("pahs", pol_category), "PAHs", pol_category),
                    pol_category = ifelse(grepl("vocs", pol_category), "VOCs", pol_category)) %>%
      dplyr::rename(" " = "pol_category",
                    "Hardwood lumps (med.)" = "Hardwood lumps (med.)1",
                    "Hardwood lumps (sm.)" = "Hardwood lumps (sm.)1",
                    "Coconut briquettes" = "Coconut briquettes1",
                    "Total" = "Total1",
                    "Kerosene" = "Kerosene1",
                    "Total" = "Total2") %>%
      kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE,
            linesep = "") %>%
      kable_styling(latex_options = c("striped"), position = "center", font_size = 9) %>%
      footnote(number = c("Seven test replicates conducted", "Ten test replicates conducted", "Nine test replicates conducted",
                         "Three test replicates conducted", "Three test replicates conducted", "Three test replicates conducted"), escape = FALSE) %>%
      row_spec(0, angle = 90) %>%
      add_header_above(c(" ", "Gasifier$^1$" = 3, "Ceramic jiko$^2$" = 4, "Metal jiko$^3$" = 4,
                         "Wick$^4$" = 1, "Pressure$^5$" = 1, "LPG$^6$" = 1), escape = FALSE) %>%
      column_spec(1, width = "10em")
```

\newpage

```{r, echo=FALSE, eval=FALSE}
  voc_lod <-
    readRDS("../../../r_data/voc_lod.RDS") %>%
    dplyr::mutate(lod = paste(lod, "ppbv*"))

  carbos_lod <- 
    readRDS("../../../r_data/carbohydrates_lod.RDS") %>%
    dplyr::mutate(lod = paste(lod, "$\\mu$g/m$^3$*"))
  
  carbons_lod <- readRDS("../../../r_data/carbonyls_lod.RDS")
  
  ions_lod <- readRDS("../../../r_data/ions_lod.RDS")
  ecoc_lod <- readRDS("../../../r_data/ecoc_lod.RDS")
  pah_lod <- readRDS("../../../r_data/pah_lod.RDS")
  
  lods <-
    voc_lod %>%
    dplyr::bind_rows(carbos_lod) %>%
    dplyr::bind_rows(carbons_lod) %>%
    dplyr::bind_rows(ions_lod) %>%
    dplyr::bind_rows(ecoc_lod) %>%
    dplyr::bind_rows(pah_lod)
```

# SI 11: Fraction of measurements below limit of detection

Fraction of measurements that were below the limit of detection (LOD) by smoke constituent. Refer to SI 11 for the total number of measurements for each stove type. Fractions were calculated using all fuel types tested on a particular stove (see Figure 1 for details on the stove-fuel combinations).

## SI 11.1: Wood stoves

```{r}
  three_stone <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove), by = "id") %>%
    dplyr::filter(stove == "Three-stone fire", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Three-stone fire" = "all")

  mud_chulha <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Mud chulha", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Mud chulha" = "all")

  rocket <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Rocket elbow", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Rocket elbow" = "all")

  plancha <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Built-in plancha", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Built-in plancha" = "all")

  fan_rocket <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Fan rocket elbow", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Fan rocket elbow" = "all")

  three_stone %>%
    dplyr::bind_cols(dplyr::select(mud_chulha, -pol)) %>%
    dplyr::bind_cols(dplyr::select(rocket, -pol)) %>%
    dplyr::bind_cols(dplyr::select(plancha, -pol)) %>%
    dplyr::bind_cols(dplyr::select(fan_rocket, -pol)) %>%
    dplyr::mutate(pol = ifelse(pol == "pm_mass", "PM$_{2.5}$", pol),
                  pol = ifelse(grepl("^co2$", pol), "carbon dioxide", pol),
                  pol = ifelse(grepl("^co$", pol), "carbon monoxide", pol),
                  pol = ifelse(grepl("^ch4$", pol), "methane", pol),
                  pol = ifelse(grepl("ultrafines", pol), "ultrafine particles", pol),
                  pol = ifelse(grepl("^om$", pol), "organic matter", pol),
                  pol = ifelse(grepl("^oc$", pol), "organic carbon", pol),
                  pol = ifelse(grepl("^ec$", pol), "elemental carbon", pol),
                  pol = ifelse(grepl("pinene", pol), "alpha-pinene", pol),
                  pol = ifelse(grepl("2_methyl_2_butene", pol), "2-methyl-2-butene", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([a-z])", "\\1-\\3", pol),
                  pol = gsub("([a-z])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("(m)(_)(p)", "\\1,\\3", pol),
                  pol = gsub("([a-z])(_)([a-z])", "\\1-\\3", pol)) %>%
      dplyr::rename(" " = "pol") %>%
      kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE,
            linesep = "") %>%
      kable_styling(latex_options = c("striped"), position = "center", font_size = 8) %>%
      column_spec(1, width = "12em")
```

\newpage

## SI 11.2: Pellet, charcoal, and fossil-fuel stoves

```{r}
  gasifier <-
    emissions %>%
    dplyr::left_join(samples %>%
                      dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Gasifier", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Gasifier" = "all")

  ceramic <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Ceramic jiko", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Ceramic jiko" = "all")

  metal <-
    emissions %>%
     dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Metal jiko", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Metal jiko" = "all")

  wick <-
    emissions %>%
    dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Wick kerosene", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Wick kerosene" = "all")
  
  pressure <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Pressure kerosene", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Pressure kerosene" = "all")

  lpg <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "LPG", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, lod) %>%
    dplyr::summarise(all = sum(lod == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("LPG" = "all")

    gasifier %>%
      bind_cols(dplyr::select(ceramic, -pol)) %>%
      bind_cols(dplyr::select(metal, -pol)) %>%
      bind_cols(dplyr::select(wick, -pol)) %>%
      bind_cols(dplyr::select(pressure, -pol)) %>%
      bind_cols(dplyr::select(lpg, -pol)) %>%
    dplyr::mutate(pol = ifelse(pol == "pm_mass", "PM$_{2.5}$", pol),
                  pol = ifelse(grepl("^co2$", pol), "carbon dioxide", pol),
                  pol = ifelse(grepl("^co$", pol), "carbon monoxide", pol),
                  pol = ifelse(grepl("^ch4$", pol), "methane", pol),
                  pol = ifelse(grepl("ultrafines", pol), "ultrafine particles", pol),
                  pol = ifelse(grepl("^om$", pol), "organic matter", pol),
                  pol = ifelse(grepl("^oc$", pol), "organic carbon", pol),
                  pol = ifelse(grepl("^ec$", pol), "elemental carbon", pol),
                  pol = ifelse(grepl("pinene", pol), "alpha-pinene", pol),
                  pol = ifelse(grepl("2_methyl_2_butene", pol), "2-methyl-2-butene", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([a-z])", "\\1-\\3", pol),
                  pol = gsub("([a-z])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("(m)(_)(p)", "\\1,\\3", pol),
                  pol = gsub("([a-z])(_)([a-z])", "\\1-\\3", pol)) %>%
      dplyr::rename(" " = "pol") %>%
      kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE,
            linesep = "") %>%
      kable_styling(latex_options = c("striped"), position = "center", font_size = 8) %>%
      column_spec(1, width = "12em")
```

\newpage

```{r, echo=FALSE, eval=FALSE}
  vocs_bg <- readRDS("../../../r_data/vocs_bg.RDS")
  carbos_bg <- readRDS("../../../r_data/carbohydrates_bg.RDS")
  carbons_bg <- readRDS("../../../r_data/carbonyls_bg.RDS")
  ions_bg <- readRDS("../../../r_data/ions_bg.RDS")
  ecoc_bg <- readRDS("../../../r_data/ecoc_bg.RDS")

  
```

# SI 12: Fraction of measurements below background

Fraction of measurements that were below the study-averaged background by smoke constituent. Refer to SI 11 for the total number of measurements for each stove type. Fractions were calculated using all fuel types tested on a particular stove (see Figure 1 for details on the stove-fuel combinations).

## SI 12.1: Wood stoves

```{r}
  three_stone <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove), by = "id") %>%
    dplyr::filter(stove == "Three-stone fire", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Three-stone fire" = "all")

  mud_chulha <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Mud chulha", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Mud chulha" = "all")

  rocket <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Rocket elbow", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Rocket elbow" = "all")

  plancha <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Built-in plancha", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Built-in plancha" = "all")

  fan_rocket <-
    emissions %>%
    dplyr::left_join(samples %>%
                       dplyr::select(id, stove, fuel), by = "id") %>%
    dplyr::filter(stove == "Fan rocket elbow", !grepl("unc", pol)) %>%
    dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Fan rocket elbow" = "all")

  three_stone %>%
    bind_cols(dplyr::select(mud_chulha, -pol)) %>%
    bind_cols(dplyr::select(rocket, -pol)) %>%
    bind_cols(dplyr::select(plancha, -pol)) %>%
    bind_cols(dplyr::select(fan_rocket, -pol)) %>%
    dplyr::mutate(pol = ifelse(pol == "pm_mass", "PM$_{2.5}$", pol),
                  pol = ifelse(grepl("^co2$", pol), "carbon dioxide", pol),
                  pol = ifelse(grepl("^co$", pol), "carbon monoxide", pol),
                  pol = ifelse(grepl("^ch4$", pol), "methane", pol),
                  pol = ifelse(grepl("ultrafines", pol), "ultrafine particles", pol),
                  pol = ifelse(grepl("^om$", pol), "organic matter", pol),
                  pol = ifelse(grepl("^oc$", pol), "organic carbon", pol),
                  pol = ifelse(grepl("^ec$", pol), "elemental carbon", pol),
                  pol = ifelse(grepl("pinene", pol), "alpha-pinene", pol),
                  pol = ifelse(grepl("2_methyl_2_butene", pol), "2-methyl-2-butene", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([a-z])", "\\1-\\3", pol),
                  pol = gsub("([a-z])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("(m)(_)(p)", "\\1,\\3", pol),
                  pol = gsub("([a-z])(_)([a-z])", "\\1-\\3", pol)) %>%
      dplyr::rename(" " = "pol") %>%
      kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE,
            linesep = "") %>%
      kable_styling(latex_options = c("striped"), position = "center", font_size = 8) %>%
      column_spec(1, width = "12em")
```

\newpage

## SI 12.2: Pellet, charcoal, and fossil-fuel stoves

```{r}
  gasifier <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Gasifier", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Gasifier" = "all")

  ceramic <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Ceramic jiko", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Ceramic jiko" = "all")

  metal <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Metal jiko", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Metal jiko" = "all")

  wick <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Wick kerosene", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Wick kerosene" = "all")
  
  pressure <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "Pressure kerosene", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("Pressure kerosene" = "all")

  lpg <-
    emissions %>%
      dplyr::left_join(samples %>%
                         dplyr::select(id, stove, fuel), by = "id") %>%
      dplyr::filter(stove == "LPG", !grepl("unc", pol)) %>%
      dplyr::filter(metric == "energy_delivered_ef") %>%
    dplyr::group_by(pol) %>%
    dplyr::select(id, pol, bg) %>%
    dplyr::summarise(all = sum(bg == "below") / n()) %>%
    dplyr::mutate(all = format(round(all, digits = 2), nsmall = 2)) %>%
    dplyr::rename("LPG" = "all")

    gasifier %>%
      bind_cols(dplyr::select(ceramic, -pol)) %>%
      bind_cols(dplyr::select(metal, -pol)) %>%
      bind_cols(dplyr::select(wick, -pol)) %>%
      bind_cols(dplyr::select(pressure, -pol)) %>%
      bind_cols(dplyr::select(lpg, -pol)) %>%
    dplyr::mutate(pol = ifelse(pol == "pm_mass", "PM$_{2.5}$", pol),
                  pol = ifelse(grepl("^co2$", pol), "carbon dioxide", pol),
                  pol = ifelse(grepl("^co$", pol), "carbon monoxide", pol),
                  pol = ifelse(grepl("^ch4$", pol), "methane", pol),
                  pol = ifelse(grepl("ultrafines", pol), "ultrafine particles", pol),
                  pol = ifelse(grepl("^om$", pol), "organic matter", pol),
                  pol = ifelse(grepl("^oc$", pol), "organic carbon", pol),
                  pol = ifelse(grepl("^ec$", pol), "elemental carbon", pol),
                  pol = ifelse(grepl("pinene", pol), "alpha-pinene", pol),
                  pol = ifelse(grepl("2_methyl_2_butene", pol), "2-methyl-2-butene", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("([0-9])(_)([a-z])", "\\1-\\3", pol),
                  pol = gsub("([a-z])(_)([0-9])", "\\1,\\3", pol),
                  pol = gsub("(m)(_)(p)", "\\1,\\3", pol),
                  pol = gsub("([a-z])(_)([a-z])", "\\1-\\3", pol)) %>%
      dplyr::rename(" " = "pol") %>%
      kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE,
            linesep = "") %>%
      kable_styling(latex_options = c("striped"), position = "center", font_size = 8) %>%
      column_spec(1, width = "12em")
```

\newpage

# SI 13: Fuel properties

Measured higher heating values (C 200 Calorimeter System; IKA; Staufen, Germany), proximate properties (Hazen Research Inc.; Golden, CO), and ultimate properties (Soil-Water-Plant laboratory at Colorado State University; Fort Collins, CO) of all fuels tested except the LPG. LPG properties were derived from the Phyllis database (https://phyllis.nl/). Fuel hydrogen contents from the Phyllis database (https://phyllis.nl/) and higher heating values (HHV) were used to calculate the lower heating values (LHV) of the fuels. Moisture content is reported on a wet basis, while all other measurements are reported on a dry basis. 

```{r, echo=FALSE}
  fuels %>%
    dplyr::filter(fuel != "lump hardwood (med.)") %>%
    dplyr::select(-hydrogen_fraction) %>%
    dplyr::mutate(carbon_fraction = carbon_fraction * 100) %>%
    dplyr::select(fuel, hhv, lhv, moisture, carbon_fraction, ash, volatile_content, fixed_carbon) %>%
    dplyr::mutate(fuel = 
                    fuel %>%
                    factor %>%
                    forcats::fct_recode("Douglas fir" = "douglas fir",
                                         "Eucalyptus" = "eucalyptus",
                                         "Oak" = "oak",
                                         "Coconut briquettes" = "coconut charcoal",
                                         "Hardwood lumps" = "lump hardwood (sm.)",
                                         "Eucalyptus pellets" = "eucalyptus pellets",
                                         "Lodgepole pine pellets" = "lodgepole pine pellets",
                                         "Kerosene" = "kerosene",
                                         "LPG" = "lpg")) %>%
    dplyr::rename(" " = "fuel",
                  "HHV (kJ/kg)" = "hhv",
                  "LHV (kJ/kg)" = "lhv",
                  "Carbon content ($\\%$)" = "carbon_fraction",
                  "Moisture content ($\\%$)" = "moisture",
                  "Ash content ($\\%$)" = "ash",
                  "Volatile content ($\\%$)" = "volatile_content",
                  "Fixed carbon content ($\\%$)" = "fixed_carbon") %>%
    kable(escape = FALSE, booktabs = TRUE, align = "c",
          linesep = "") %>%
    kable_styling(latex_options = c("striped"), position = "center", font_size = 12) %>%
    footnote(general_title = "Notes: ", threeparttable = TRUE, escape = FALSE) %>%
    row_spec(0, angle = 90)
```

\newpage

# SI 14: Stove types that were excluded from leave-one-out cross validation

List of stove types that were excluded from the regression analysis by pollutant. Stove types were exluded from the leave-one-out cross validation if they had less than three data points, because only two data points would be avaliable to fit the data. Replicates could be missing if they the measurement was below background or there were measurement issues. Missing stove types were excluded from both models presented in the main manuscript for consistency.

```{r, echo=FALSE}
  missing_stoves %>%
    dplyr::mutate(stove = 
                    stove %>% 
                    forcats::fct_recode("Three-stone fire" = "three-stone fire",
                                        "Mud chulha" = "chulha",
                                        "Rocket elbow" = "rocket elbow",
                                        "Built-in plancha" = "built-in plancha",
                                        "Fan rocket elbow" = "fan rocket-elbow",
                                        "Gasifier" = "forced-draft gasifier",
                                        "Ceramic jiko" = "ceramic charcoal",
                                        "Metal jiko" = "metal charcoal",
                                        "Wick kerosene" = "wick kerosene",
                                        "Pressure kerosene" = "pressure kerosene",
                                        "LPG" = "lpg") %>%
                  forcats::fct_relevel("Three-stone fire",
                                       "Mud chulha",
                                       "Rocket elbow",
                                       "Built-in plancha",
                                       "Fan rocket elbow",
                                       "Gasifier",
                                       "Ceramic jiko",
                                       "Metal jiko",
                                       "Wick kerosene",
                                       "Pressure kerosene",
                                       "LPG")) %>%
    dplyr::group_by(pol) %>%
    dplyr::summarise(stove = paste(stove, collapse = ", ")) %>%
    dplyr::rename("Missing stove types" = "stove", " " = pol) %>%
      kable("latex", escape = FALSE,  booktabs = TRUE, align = 'c', longtable = TRUE,
            linesep = "") %>%
      kable_styling(latex_options = c("striped"), position = "center", font_size = 8) %>%
      column_spec(1, width = "12em") %>%
      column_spec(2, width = "30em")
```

