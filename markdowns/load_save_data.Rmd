---
title: "Load and save data"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r load_libraries, echo=FALSE, message=FALSE}
  if (!require("pacman")) install.packages("pacman")
  pacman::p_load(tidyverse, knitr, forcats)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(warning = FALSE, message = FALSE, cache = FALSE)
```

```{r}
  source("../scripts/load_data.R")
  source("../scripts/load_metadata.R")
  source("../scripts/functions.R")
```

# Pollutant data

## co2

* load and save co2 data
* logged as voltage or mixing ratio

```{r} 
  co2_lab <- load_multifile(fldr = "../data/co2",
                            pattern = "DILUTION1.csv$", inst = "co2")

  saveRDS(co2_lab, file = "../r_data/co2_lab.RDS")

  co2_sample <- load_multifile(fldr = "../data/co2",
                               pattern = "DILUTION2.csv$", inst = "co2")

  saveRDS(co2_sample, file = "../r_data/co2_sample.RDS")

  co2_lab_sample <- load_multifile(fldr = "../data/co2",
                                   pattern = "DILUTION.csv$", inst = "co2")

  saveRDS(co2_lab_sample, file = "../r_data/co2_lab_sample.RDS")
```

## ecoc

* load and save ecoc data

```{r} 
  ecoc <- load_multifile(fldr = "../data/ecoc",
                         pattern = "ECOC.csv$",
                         inst = "ecoc")

  saveRDS(ecoc, file = "../r_data/ecoc.RDS")
```  

## five gas

* load and save five gas data
* logged as voltage or mixing ratio

```{r}
  fivegas_conc <- load_fivegas(type = "conc")

  saveRDS(fivegas_conc, file = "../r_data/fivegas_conc.RDS")

  fivegas_volts <- load_fivegas(type = "volts")

  saveRDS(fivegas_volts, file = "../r_data/fivegas_volts.RDS")

  fivegas_calibration <- load_fivegas(pattern = "_CALIBRATION_",
                                      type = "volts")

  saveRDS(fivegas_calibration, file = "../r_data/fivegas_calibration.RDS")
```

## gravimetric

* load and save gravimetric data

```{r}
  grav <- load_singlefiles("grav")

  saveRDS(grav, file = "../r_data/grav.RDS")
```

## ions and carbonyls

* load and save ion and carbonyl data

```{r} 
  ions <- load_singlefiles("ions")

  saveRDS(ions, file = "../r_data/ions.RDS")
```

## pahs

* load and save pah data

```{r}
  pah <- load_multifile(fldr = "../data/pah",
                        pattern = "^PAH_.*[0-9].csv$", inst = "pah") 
  saveRDS(pah, file = "../r_data/pah.RDS")

  pah_bdl <- load_multifile(fldr = "../data/pah",
                            pattern = "BDL", inst = "pah_bdl") 
  saveRDS(pah_bdl, file = "../r_data/pah_bdl.RDS")
```

## pax

* load and save pax data

```{r}
  pax <- load_multifile(fldr = "../data/pax",
                        pattern = "ALLDAY_PAX.csv$", inst = "pax")

  saveRDS(pax, file = "../r_data/pax.RDS")
```

## scale

* load and save real-time mass data

```{r} 
  scale <- load_multifile(fldr = "../data/scale",
                          pattern = "_SCALE.xlsx$", inst = "scale")

  saveRDS(scale, file = "../r_data/scale.RDS")
```

## smps

* load and save smps data

```{r} 
  smps <- load_multifile(fldr = "../data/smps",
                         pattern = "_SMPS.csv$", inst = "smps")

  saveRDS(smps, file = "../r_data/smps.RDS")
```

## temperature

* load and save thermocouple data

```{r}
  temp <- load_multifile(fldr = "../data/temp",
                         pattern = "_TEMP.csv|_TEMP.CSV", inst = "temp")

  saveRDS(temp, file = "../r_data/temp.RDS")
```

## transmissometer

* load and save transmissometer data

```{r}
  trans <- load_singlefiles("trans")

  saveRDS(trans, file = "../r_data/trans.RDS")
```
 
## vocs

* load and save voc data
 
```{r}
  voc <- load_singlefiles("voc")

  saveRDS(voc, file = "../r_data/voc.RDS")
```

```{r}
  voc_lod <- readr::read_csv("../data/voc/voc_lods.csv")

  saveRDS(voc_lod, file = "../r_data/voc_lod.RDS")
```

# Metadata

## sample logs

* load test info

```{r}
  samples <- load_singlefiles("sample")
```

* save test info

```{r}
  saveRDS(samples, file = "../r_data/samples.RDS")
```

## batch sample meta data

* weights (fuel, pot, ...)
* times (start, refuel, ...)
* lab conditions (T, RH, P)
* notes
 
```{r}  
  batch <- load_singlefiles("batch")

  batch <- dplyr::filter(batch, grepl("^[0-9]", id))

  saveRDS(batch, file = "../r_data/batch.RDS")
```

## wood sample meta data

* weights (fuel, pot, ...)
* times (start, refuel, ...)
* lab conditions (T, RH, P)
* notes

```{r} 
  wood <- load_singlefiles("wood")

  wood <- dplyr::filter(wood, grepl("^[0-9]", id))

  saveRDS(wood, file = "../r_data/wood.RDS")
```

## calibration log 1

* fivegas calibration standards
* fivegas calibration timestamps

```{r}
  cal_1 <- load_singlefiles("cal_1")

  saveRDS(cal_1, file = "../r_data/cal_1.RDS")
```

## calibration log 2

* co2 calibration information
* pax and smps flow measurements

```{r}  
  cal_2 <- load_singlefiles("cal_2")

  saveRDS(cal_2, file = "../r_data/cal_2.RDS")
```

## data log 1

* load and save data
* filter cartridge flows and times
* voc times
* fivegas background times
* notes

```{r} 
  data_1 <- load_singlefiles("data_1")

  saveRDS(data_1, file = "../r_data/data_1.RDS")
```
 
## data log 2

* load and save data
* carbonyls and isokinetic inlet times and flows
* smps and pax times (including background)

```{r} 
  data_2 <- load_singlefiles("data_2")

  saveRDS(data_2, file = "../r_data/data_2.RDS")
```
