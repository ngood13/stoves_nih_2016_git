---
title: "Load and save data"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  library(tidyverse)
  library(forcats)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  source("../r_scripts/R_load_data.R")
  source("../r_scripts/R_load_metadata.R")
  source("../r_scripts/R_tidy.R")
  source("../r_scripts/R_functions.R")
```

# Pollutant data

## ecoc

Loads ecoc data file and resave as .RDS

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  ecoc <- load_singlefiles("ecoc")
  # saveRDS(ecoc, file = "../r_files/ecoc.RDS")
```

## fivegas

The fivegas analyzer recorded co, co2 and ch4.

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  fivegas <- load_fivegas()
  saveRDS(fivegas, file = "../r_files/fivegas.RDS")
```

## gravimetric

Loads filter weight data and resaves as .RDS.

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  grav <- load_singlefiles("grav")
  saveRDS(grav, file = "../r_files/grav.RDS")
```

## ions and carbonyls

Loads and resaves data as .RDS.

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  ions <- load_singlefiles("ions")
  saveRDS(ions, file = "../r_files/ions.RDS")
```

## pahs

Loads and resaves data as .RDS.

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  # pah <- load_singlefiles("pah")
  # save(pah, file = "../r_files/pah.RDS")
```

## pax

Loads and resaves data as .RDS.

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  pax <- load_multifile(fldr = "../data/pax",
                        pattern = ".*_PAX.csv$", inst = "pax")

  saveRDS(pax, file = "../r_files/pax.RDS")
```

## temperature

Loads and resaves data as an .RDS.

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  temp <- load_multifile(fldr = "../data/temp",
                         pattern = ".*TEMPERATURE.CSV$", inst = "temp")

  saveRDS(temp, file = "../r_files/temp.RDS")
```

## vocs

Loads the microgram sheet and resaves data as an .RDS.
 
```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  voc <- load_singlefiles("voc")
  saveRDS(voc, file = "../r_files/voc.RDS")
```

# Metadata

## sample matrix

Load sample matrix. Function saves two .RDS files (test_info and ids_int).

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  samples <- load_singlefiles("sample")
```

Load metadata. Function to save files for: flows, canister pressure, background_times, fuel_times, fuel mass, and notes.

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  metadata <- load_singlefiles("meta")
```

Kristen's notes

```{r, message=FALSE, results='markup', cache=FALSE}
  notes_kf <- readr::read_csv("../data/logs/startup_qc_notes.csv") %>%
              dplyr::rename(id_test = id,
                            inst = instrument) %>%
              left_join(dplyr::select(samples[[1]], id, id_test), by = "id_test")
  saveRDS(notes_kf, "../r_files/notes_kf.RDS")
```

