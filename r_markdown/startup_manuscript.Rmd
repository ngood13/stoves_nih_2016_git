---
title: "Startup Manuscript"
output: html_document
---

```{r global_options, include = FALSE}
  knitr::opts_chunk$set(fig.path = 'figures/',
                        warning = FALSE,
                        message = FALSE,
                        fig.width = 10, fig.height = 4,
                        cache = FALSE)
```

```{r setup, include=FALSE}
  library(tidyverse)
  library(knitr)
  library(dunn.test)
  library(lsmeans)
  library(pairwiseCI)
  library(corrplot)
  source("../r_scripts/R_functions.R")
```

```{r read data, include=FALSE}
  emission_factors <- readRDS(file = "../r_files/emission_factors.RDS")
  fuel_burnt_reps <- readRDS(file = "../r_files/fuel_burnt_reps.RDS")
  qc <- readRDS(file = "../r_files/qc.RDS")
```


# Results

## Prepare data

* calculate mean fuel consumed per fuel type

```{r, include = FALSE}
  fuel_consumed <- fuel_burnt_reps %>%
                   dplyr::left_join(dplyr::select(qc, id, qc),
                                                  by = "id") %>%
                   dplyr::filter(!is.na(dm), qc != "bad") %>%
                   dplyr::mutate(dur = (off - on) / 60) %>%
                   dplyr::group_by(fuel) %>%
                   dplyr::summarise(mean_dm = mean(dm),
                                    min_dm = min(dm),
                                    max_dm = max(dm),
                                    total_dm = sum(dm),
                                    mean_burn_time = round(mean(dur), 1), #in minutes per startup
                                    min_burn_time = round(min(dur), 1),
                                    max_burn_time = round(max(dur), 1),
                                    num_reps = n()) %>%
                   dplyr::mutate(fuel = forcats::fct_relevel(fuel,
                                                             "background", "kerosene",
                                                             "leaves_twigs", "flipflops",
                                                             "rubber", "newspaper",
                                                             "wood_shims", "t_shirts",
                                                             "food_packaging", "plastic_bags")) %>%
                   dplyr::mutate(fuel = forcats::fct_drop(fuel, "blank")) %>%
                   dplyr::mutate(fuel_names = forcats::fct_recode(fuel, "plastic bags" = "plastic_bags",
                                                                   "kindling" = "leaves_twigs",
                                                                   "inner tubes" = "rubber",
                                                                   "footwear" = "flipflops",
                                                                   "fabric" = "t_shirts",
                                                                   "wood shims" = "wood_shims",
                                                                   "food packaging" = "food_packaging"))

  kable(fuel_consumed, digits = 3)
```

* calculate emissions metrics

```{r, echo = FALSE}
# set variable types from character -> factor
# filter out bad QC data
# set fuel type order by survey result "commonality" of use. 
# create variable mass (g) pollutant emitted per startup event
# create variable average mass (g) of startup material per startup event
# filter out backgrounds and blanks
  per_test <- dplyr::mutate(emission_factors, fuel = factor(fuel),
                                              qc = factor(qc),
                                              pol = factor(pol)) %>%
              dplyr::rename(mass_emitted = value) %>%
              dplyr::select(-metric) %>%
              dplyr::filter(qc != "bad") %>%
              dplyr::mutate(fuel = forcats::fct_relevel(fuel, "background", "kerosene",
                                                              "leaves_twigs", "flipflops",
                                                              "rubber", "newspaper",
                                                              "wood_shims", "t_shirts",
                                                              "food_packaging", "plastic_bags")) %>%
              dplyr::mutate(fuel_names = forcats::fct_recode(fuel, "plastic bags" = "plastic_bags",
                                                                   "kindling" = "leaves_twigs",
                                                                   "inner tubes" = "rubber",
                                                                   "footwear" = "flipflops",
                                                                   "fabric" = "t_shirts",
                                                                   "wood shims" = "wood_shims",
                                                                   "food packaging" = "food_packaging"),
                            mass_pol_per_startup = (mass_emitted * 1e-3) / fuel_quant, # mg per startup event
                            mass_fuel_per_startup = fuelmass_total / fuel_quant, # g per startup event
                            mass_pol_per_mass_fuel = (mass_emitted * 1e-3) / fuelmass_total) %>%  # mg/g (same as g/kg)
              dplyr::filter(!grepl("^B", id_test)) %>%
              dplyr::left_join(dplyr::select(fuel_consumed, fuel_names, mean_dm),
                               by = "fuel_names") %>%
              dplyr::mutate(fuel_quant_std = fuelmass_total / mean_dm,
                            mass_pol_per_startup_std = (mass_emitted * 1e-3) / fuel_quant_std) # mg/standard startup

```

* QC comparison - standardized "startup event" vs. per-test average startup event
```{r, include = FALSE, fig.width = 15, fig.height = 18, eval = FALSE}
ggplot(per_test) +
geom_point(aes(x= id, y=mass_pol_per_startup), size = 2, color = 'red') +
  geom_point(aes(x=id, y=mass_pol_per_startup_std), size = 2, color = 'black') +
    facet_wrap(~pol, scales = "free", ncol = 3) +
  theme_bw() +
  theme(legend.position = "top")
```

## Table 1

* experiment summary

```{r, echo = FALSE}
  fuel_sum <- dplyr::filter(per_test, pol == 'grav') %>% 
              dplyr::group_by(fuel_names) %>%
              dplyr::summarize(n_tests = n(),
                               n_events_per_test = round(mean(fuel_quant), 2),
                               min_events_per_test = min(fuel_quant),
                               max_events_per_test = max(fuel_quant),
                               n_events_per_test_std = round(mean(fuel_quant_std), 2),
                               min_events_per_test_std = round(min(fuel_quant_std), 2),
                               max_events_per_test_std = round(max(fuel_quant_std), 2)) %>%
             dplyr::left_join(select(fuel_consumed, -fuel, -num_reps), by = "fuel_names") %>%
             dplyr::mutate(mean_dm = round(mean_dm, 2),
                           max_dm = round(max_dm, 2),
                           total_dm = round(total_dm, 2))

knitr::kable(fuel_sum)
```

## Table 2

* emissions per startup event (mg per startup event), average per test

```{r, echo = FALSE}
  mean_per_startup <- per_test %>%
                      dplyr::group_by(inst, fuel_names, pol) %>%
                      dplyr::summarize(nreps = n(),
                                   mean = mean(mass_pol_per_startup_std, na.rm = TRUE),
                                   min = min(mass_pol_per_startup_std, na.rm = TRUE),
                                   max = max(mass_pol_per_startup_std, na.rm = TRUE),
                                   stdev = sd(mass_pol_per_startup_std, na.rm = TRUE),
                                   cov = round(((stdev/mean) * 100), 2),
                                   variation_pct = round(((max - min) / max)*100, 0),
                                   variation_act = round((max - min), 2)) %>%
                      dplyr::ungroup() %>%
                      dplyr::mutate(mean_round = ifelse(inst == "carbs" | inst == "voc", round(mean, 2), 
                                                        round(mean,0)),
                                    min_round = ifelse(inst == "carbs" | inst == "voc", round(min, 2),
                                                       round(min,0)),
                                    max_round = ifelse(inst == "carbs" | inst == "voc", round(max, 2),
                                                       round(max,0)),
                                    result_table = paste0(mean_round, " (", min_round, ", ", max_round, ")"))

  

  mean_per_startup_table <- mean_per_startup %>%
                            dplyr::select(fuel_names, pol, result_table, inst) %>%
                            tidyr::spread(fuel_names, result_table) %>%
                            dplyr::arrange(inst)

  write_csv(mean_per_startup_table, "../r_files/mean_per_startup_table.csv")

  knitr::kable(mean_per_startup_table)
```

## Supplemental Table 1

* emissions per mass fuel (mg per g fuel (same as g/kg))

```{r, echo = FALSE}
  per_fuel_mass <- per_test %>%
                      dplyr::group_by(inst, fuel_names, pol) %>%
                      dplyr::summarize(nreps = n(),
                                   mean = mean(mass_pol_per_mass_fuel, na.rm = TRUE),
                                   min = min(mass_pol_per_mass_fuel, na.rm = TRUE),
                                   max = max(mass_pol_per_mass_fuel, na.rm = TRUE)) %>%
                      dplyr::ungroup() %>%
                      dplyr::mutate(mean_round = ifelse(inst == "carbs" | inst == "voc", round(mean, 2), 
                                                        round(mean,0)),
                                    min_round = ifelse(inst == "carbs" | inst == "voc", round(min, 2),
                                                       round(min,0)),
                                    max_round = ifelse(inst == "carbs" | inst == "voc", round(max, 2),
                                                       round(max,0)),
                                    result_table = paste0(mean_round, " (", min_round, ", ", max_round, ")"))

  per_fuel_mass_table <- per_fuel_mass %>%
                            dplyr::select(fuel_names, pol, result_table, inst) %>%
                            tidyr::spread(fuel_names, result_table) %>%
                            dplyr::arrange(inst)

  write_csv(per_fuel_mass_table, "../r_files/mean_per_fuel_mass_table.csv")

  knitr::kable(per_fuel_mass_table)
```

## Figure 1.

* Experimental setup - created in powerpoint

## Figure 2.

* emissions of key pollutants (standardized calc)

```{r, echo = FALSE, fig.width = 12, fig.height = 17}
  p_data_key <- dplyr::filter(per_test, grepl('^grav$|^co$|^formaldehyde$|^acetaldehyde$|^voc_benzene$|^voc_toluene$|^oc$|^ec$', pol)) %>% 
                dplyr::mutate(pol = sub("^voc_", "", pol),
                              pol = sub("^grav", "PM2.5", pol)) %>%
                dplyr::mutate(pol = forcats::fct_relevel(pol, "PM2.5", "co", "ec", "oc",
                                                      "formaldehyde", "acetaldehyde",
                                                      "benzene", "toluene")) #%>%
                #dplyr::mutate(fuel_names = forcats::fct_relevel(fuel_names, "kerosene", "wood shims", "kindling", 
                #                                                       "newspaper", "fabric", 
                #                                                       "plastic bags", "food packaging", 
                #                                                       "inner tubes", "footwear"))

  p_data_key_means <- dplyr::filter(mean_per_startup, grepl('^grav$|^co$|^formaldehyde$|^acetaldehyde$|^voc_benzene$|^voc_toluene$|^oc$|^ec$', pol)) %>%
                      dplyr::mutate(pol = sub("^voc_", "", pol),
                                    pol = sub("^grav", "PM2.5", pol))%>%
                      dplyr::mutate(pol = forcats::fct_relevel(pol, "PM2.5", "ec", "oc", "co",
                                                                    "formaldehyde", "acetaldehyde",
                                                                    "benzene", "toluene"))

  ggplot(p_data_key, aes(fuel_names, mass_pol_per_startup_std, color = fuel)) +
  geom_point(size = 5, shape = 1, stroke = 2) +
  #geom_point(data = p_data_key_means, aes(x = fuel_names, y = mean), colour = 'black', size = 10, shape = 95, stroke = 2) + 
  #geom_vline(xintercept = 4.5, col='black', lwd=1) +
    theme_bw() +
  theme(legend.position = "none",
        text = element_text(size=25),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 25))) +
  scale_y_log10(breaks = c(0, 0.1, 0.5, 1, 3, 10, 25, 100, 500, 1000)) + 
  ylab("Emissions Factor (mg per startup event) per Test") + xlab("Fuel Type") +
  facet_wrap(~pol, scales = "free", ncol = 2)
```

## Supplemental Figure 1.

* emissions of key pollutants (mass per mass fuel basis)

```{r, echo = FALSE, fig.width = 12, fig.height = 17}
  p_data_key_reorder <- p_data_key %>%
                        dplyr::mutate(fuel_names = forcats::fct_relevel(fuel_names, "inner tubes", "footwear", 
                                                                        "kerosene", "kindling",
                                                                       "newspaper", "fabric", "food packaging",
                                                                       "wood shims", "plastic bags"))

  ggplot(p_data_key_reorder, aes(fuel_names, mass_pol_per_mass_fuel, color = fuel)) +
  geom_point(size = 5, shape = 1, stroke = 2) +
    theme_bw() +
  theme(legend.position = "none",
        text = element_text(size=25),
        axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 25))) +
  ylab("Emissions Factor (g/kg) per Test") + xlab("Fuel Type") +
  facet_wrap(~pol, scales = "free", ncol = 2)
```


## pairwise comparisons of key pollutants (for text)

### PM2.5

* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  grav_means <- dplyr::filter(p_data_key, grepl('^PM2.5$', pol))

  #pm_cont <- lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = grav_means)), pairwise ~ fuel_names, adjust = "none")

  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = grav_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 0), " (", round(lower, 0), ", ", round(upper, 0), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/pm25_contrasts.csv")

  knitr::kable(df)
```

* Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = grav_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = grav_means$mass_pol_per_startup_std, g = grav_means$fuel_names, method = "none")
```

### CO

* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  co_means <- dplyr::filter(p_data_key, grepl('^co$', pol))

  #lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = co_means)), pairwise ~ fuel_names, adjust = "none")
  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = co_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 0), " (", round(lower, 0), ", ", round(upper, 0), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/co_contrasts.csv")

  knitr::kable(df)
```

* Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = co_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = co_means$mass_pol_per_startup_std, g = co_means$fuel_names, method = "none")
```

### formaldehyde
* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  for_means <- dplyr::filter(p_data_key, grepl('^formaldehyde$', pol))

  #lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = for_means)), pairwise ~ fuel_names, adjust = "none")
  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = for_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 2), " (", round(lower, 2), ", ", round(upper, 2), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/formaldehyde_contrasts.csv")
  
  knitr::kable(df)
```

* Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = for_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = for_means$mass_pol_per_startup_std, g = for_means$fuel_names, method = "none")
```

### acetaldehyde
* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  acet_means <- dplyr::filter(p_data_key, grepl('^acetaldehyde$', pol))

  #lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = acet_means)), pairwise ~ fuel_names, adjust = "none")
  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = acet_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 2), " (", round(lower, 2), ", ", round(upper, 2), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/acetaldehyde_contrasts.csv")
  knitr::kable(df)
```

* Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = acet_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = acet_means$mass_pol_per_startup_std, g = acet_means$fuel_names, method = "none")
```

### benzene
* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  bz_means <- dplyr::filter(p_data_key, grepl('^benzene$', pol))

  #lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = bz_means)), pairwise ~ fuel_names, adjust = "none")
  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = bz_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 2), " (", round(lower, 2), ", ", round(upper, 2), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/benzene_contrasts.csv")
  
  knitr::kable(df)
```

* Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = bz_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = bz_means$mass_pol_per_startup_std, g = bz_means$fuel_names, method = "none")
```

### toluene
* pairwise t test (standard ANOVA) to get mean contrasts
```{r, echo = FALSE}
  tol_means <- dplyr::filter(p_data_key, grepl('^toluene$', pol))

  #lsmeans((aov(mass_pol_per_startup_std ~ fuel_names, data = tol_means)), pairwise ~ fuel_names, adjust = "none")
  out <- pairwiseCI(mass_pol_per_startup_std ~ fuel_names, data = tol_means)
  
  df <- as_data_frame(out) %>%
        mutate(estimate = estimate * -1,
               lower = lower * -1,
               upper = upper * -1,
               result = paste0(round(estimate, 2), " (", round(lower, 2), ", ", round(upper, 2), ")"),
               comparison = paste0(sub(".*-", "", comparison), "-", sub("-.*", "", comparison)),
               comp_a = as.factor(sub("-.*", "", comparison)),
               comp_b = as.factor(sub(".*-", "", comparison)),
               comp_a = forcats::fct_relevel(comp_a, "kerosene",
                                                     "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes"),
               comp_b = forcats::fct_relevel(comp_b, "wood shims",
                                                     "kindling",
                                                     "newspaper",
                                                     "fabric",
                                                     "plastic bags",
                                                     "food packaging",
                                                     "inner tubes",
                                                     "footwear")) %>%
               select(result, comp_a, comp_b) %>%
               spread(comp_a, result) %>%
               arrange(comp_b)
  
  write_csv(df, "../r_files/toluene_contrasts.csv")
  
  knitr::kable(df)
```

*Shapiro Wilks test for normality: small p-value indicates non-normal data.
```{r}
  shapiro.test(residuals(aov(mass_pol_per_startup_std ~ fuel_names, data = tol_means)))
```

* Kruskal-Wallis rank sum test (non-parametric alternative for non-normally distributed data)
```{r, echo = FALSE}
  dunn.test(x = tol_means$mass_pol_per_startup_std, g = tol_means$fuel_names, method = "none")
```

# variations in emissions for key pollutants (for text) 

* variation in emissions per test for key pollutants - coefficient of variation (COV)

```{r, echo = FALSE}
var_per_fuel_cov <- mean_per_startup %>%
                            dplyr::filter(grepl('^grav$|^co$|^formaldehyde$|^acetaldehyde$|^voc_benzene$|^voc_toluene$|^oc$|^ec$', pol)) %>% 
                            dplyr::mutate(fuel_names = factor(fuel_names, levels = c("kerosene", "wood shims", "kindling", 
                                                                                     "newspaper", "fabric", 
                                                                                     "plastic bags", "food packaging", 
                                                                                     "inner tubes", "footwear"))) %>%
                            dplyr::select(fuel_names, pol, cov) %>%
                            tidyr::spread(fuel_names, cov) %>%
                            dplyr::arrange(pol)

  knitr::kable(var_per_fuel_cov)
```

* variation in emissions per test for key pollutants - actual value variation min to max (g/startup). 

```{r, echo = FALSE}
var_per_fuel_act <- mean_per_startup %>%
                            dplyr::filter(grepl('^grav$|^co$|^formaldehyde$|^acetaldehyde$|^voc_benzene$|^voc_toluene$|^oc$|^ec$', pol)) %>%
                            dplyr::mutate(fuel_names = factor(fuel_names, levels = c("kerosene", "wood shims", "kindling", 
                                                                                     "newspaper", "fabric", 
                                                                                     "plastic bags", "food packaging", 
                                                                                     "inner tubes", "footwear"))) %>%
                            dplyr::select(fuel_names, pol, variation_act) %>%
                            tidyr::spread(fuel_names, variation_act) %>%
                            dplyr::arrange(pol)

  knitr::kable(var_per_fuel_act)
```

* variation in emissions per test for key pollutants - - percent variation min to max 

```{r, echo = FALSE}
var_per_fuel_pct <- mean_per_startup %>%
                            dplyr::filter(grepl('^grav$|^co$|^formaldehyde$|^acetaldehyde$|^voc_benzene$|^voc_toluene$|^oc$|^ec$', pol)) %>%
                            dplyr::mutate(fuel_names = factor(fuel_names, levels = c("kerosene", "wood shims", "kindling", 
                                                                                     "newspaper", "fabric", 
                                                                                     "plastic bags", "food packaging", 
                                                                                     "inner tubes", "footwear"))) %>%
                            dplyr::select(fuel_names, pol, variation_pct) %>%
                            tidyr::spread(fuel_names, variation_pct) %>%
                            dplyr::arrange(pol)

  knitr::kable(var_per_fuel_pct)
```

## Figure 3.

* stacked bar charts of health relevent pollutant categories.
* change carcinogens to ECOC once have data

```{r, echo = FALSE, fig.width = 6, fig.height = 4}
  pol_cats <- mean_per_startup %>%
              dplyr::filter(pol == "voc_benzene" |
                            pol == "voc_toluene" |
                            pol == "voc_ethylbenzene" |
                            pol == "voc_m_p_xylene" |
                            pol == "voc_o_xylene") %>%
              dplyr::mutate(cat = "BTEX") %>%
              dplyr::mutate(pol = sub("^voc_", "", pol),
                             pol = sub(".*xylene.*", "xylenes", pol)) %>%
              dplyr::bind_rows(dplyr::filter(mean_per_startup,
                                             pol == "ec" |
                                             pol == "oc") %>%
                               dplyr::mutate(cat = "ecoc")) %>%
              dplyr::mutate(fuel_names = factor(fuel_names, levels = c("kerosene", "wood shims", "kindling", 
                                                                       "newspaper", "fabric", 
                                                                       "plastic bags", "food packaging", 
                                                                       "inner tubes", "footwear"))) %>%
              dplyr::mutate(mean = ifelse(mean < 0, 0, mean)) %>% # deals with negative plastic bag ecoc
              dplyr::mutate(pol = factor(pol, levels = c("benzene", "toluene", "ethylbenzene", "xylenes", "ec", "oc")))

#palette <- c("#0099CC", "#33CC99", "#FF6633", "#FF9900", "#CC6633", "#330099")
#palette <- c("#0099CC", "#FF6633", "#CC6633", "#FF9900", "gray30", "#339999")
 palette <- c("#339999", "#33CC99", "#0099CC", "#330099", "gray30", "dodgerblue3")

stacked_plot <- ggplot(pol_cats, aes(fuel_names, mean)) +
                geom_col(aes(fill = pol), position = "stack") +
                #geom_vline(xintercept = 4.5, col='black', lwd=1) +
                facet_wrap(~cat, scale = "free") +
                theme_bw() +
                theme(legend.position = "top",text = element_text(size=15), 
                      axis.text.x = element_blank(),
                      axis.title.x=element_blank()) +
                scale_fill_manual(values = palette) +
                theme(legend.title=element_blank(),
                      axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 14.25), size = 11)) +
                #scale_y_continuous(limits = c(0, inf)) + 
                ylab("mg per startup event")

filled_plot <- ggplot(pol_cats, aes(fuel_names, mean)) +
               geom_col(aes(fill = pol), position = "fill") +
               #geom_vline(xintercept = 4.5, col='black', lwd=1) +
               facet_wrap(~cat, scales = "free") +
               theme_bw() +
               theme(legend.position = "none",text = element_text(size=15), 
                     axis.text.x = element_text(angle = 45, hjust = 1)) +
               scale_fill_manual(values = palette) +
               theme(legend.title=element_blank(),
                     axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10), size = 11)) +
               ylab("fraction of total") +
               xlab("Startup Material")
```

```{r, echo = FALSE, fig.width = 6, fig.height = 9}
gridExtra::grid.arrange(stacked_plot, filled_plot)
```

## Supplemental Figure 2. 

* stacked bar charts of health relevent pollutant categories - 

```{r, echo = FALSE, fig.width = 6, fig.height = 4}

  pol_cats2 <- per_fuel_mass %>%
               dplyr::filter(pol == "voc_benzene" |
                             pol == "voc_toluene" |
                             pol == "voc_ethylbenzene" |
                             pol == "voc_m_p_xylene" |
                             pol == "voc_o_xylene") %>%
               dplyr::mutate(cat = "BTEX") %>%
               dplyr::bind_rows(dplyr::filter(per_fuel_mass,
                                              pol == "ec" | pol == "oc") %>%
                               dplyr::mutate(cat = "ecoc")) %>%
               dplyr::mutate(pol = sub("^voc_", "", pol),
                             pol = sub(".*xylene.*", "xylenes", pol)) %>%
               dplyr::mutate(fuel_names = factor(fuel_names, levels = c("kerosene", "wood shims", "kindling",
                                                                        "newspaper", "fabric",
                                                                        "plastic bags", "food packaging",
                                                                        "inner tubes", "footwear"))) %>%
               dplyr::mutate(mean = ifelse(mean < 0, 0, mean)) %>% # deals with negative plastic bag ecoc
               dplyr::mutate(pol = factor(pol, levels = c("benzene", "toluene", "ethylbenzene", "xylenes", "ec", "oc")))

  stacked_plot2 <- ggplot(pol_cats2, aes(fuel_names, mean)) +
                   geom_col(aes(fill = pol), position = "stack") +
                   #geom_vline(xintercept = 4.5, col='black', lwd=1) +
                   facet_wrap(~cat, scales = "free") +
                   theme_bw() +
                   theme(legend.position = "top",text = element_text(size=15), 
                         axis.text.x = element_blank(),
                         axis.title.x=element_blank()) +
                   scale_fill_manual(values = palette) +
                   theme(legend.title=element_blank(),
                         axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 14.25), size = 11)) +
                   scale_y_continuous() + #limits = c(0, 60)) + 
                   ylab("g per kg") 

  filled_plot2 <- ggplot(pol_cats, aes(fuel_names, mean)) +
                  geom_col(aes(fill = pol), position = "fill") +
                  #geom_vline(xintercept = 4.5, col='black', lwd=1) +
                  facet_wrap(~cat, scales = "free") +
                  theme_bw() +
                  theme(legend.position = "none",text = element_text(size=15), 
                        axis.text.x = element_text(angle = 45, hjust = 1)) +
                  scale_fill_manual(values = palette) +
                  theme(legend.title=element_blank(),
                        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10), size = 11)) +
                  ylab("fraction of total") +
                  xlab("Startup Material")

```

```{r, echo = FALSE, fig.width = 6, fig.height = 9}
  gridExtra::grid.arrange(stacked_plot2, filled_plot2)
```

# Correlations 

```{r, echo =FALSE, fig.width = 15, fig.height = 15}
  cor_data <- per_fuel_mass %>%
              dplyr::select(-inst, -nreps, -min, -max) %>%
              dplyr::mutate(mean = as.numeric(mean)) %>%
              dplyr::select(fuel_names, pol, mean) %>%
              tidyr::spread(pol, mean) %>%
              dplyr::select(-fuel_names, -m_p_tolualdehyde) %>%
              dplyr::mutate_all(as.numeric) %>%
              dplyr::rename(dimethylbenzaldehyde = "2_5_dimethylbenzaldehyde") %>%
              dplyr::select(-dimethylbenzaldehyde)

  cors <-(cor(cor_data, method = "spearman"))

  
  corrplot.mixed(cors, lower.col = "black", upper = "color", number.cex = 1, tl.pos = "lt", diag = "l")

```

## Figure 4

### PM vs CO

* g/kg

```{r, echo=FALSE, fig.width = 6}
  pmco <- dplyr::filter(per_fuel_mass, grepl('^grav$|^co$', pol)) %>%
          dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                          fuel_names == 'kerosene' |
                                          fuel_names == 'wood shims' | 
                                          fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  pmco_pertest <- dplyr::filter(per_test, grepl('^grav$|^co$', pol)) %>%
                  dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                  tidyr::spread(pol, mass_pol_per_mass_fuel)
  
 # rho calculations
  rho_sp <- cor(pmco$grav, pmco$co, method = "spearman")
  rho_pear <- cor(pmco$grav, pmco$co, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
        geom_point(data = pmco, aes(x = grav, y = co, colour = fuel_names), shape = 17, size = 5) +
        geom_point(data = pmco_pertest, aes(x = grav, y = co, colour = fuel_names), shape = 1, size = 3, stroke = 1.5) +
        geom_text(data = rhos, aes(x = 50, y = 50, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
            geom_text(data = rhos, aes(x = 49.5, y = 46, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          ylab("CO") +
          xlab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "left",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```

### formaldehyde vs acetaldehyde

* g/kg

```{r, echo=FALSE, fig.width = 6}
  carbs <- dplyr::filter(per_fuel_mass, grepl('^formaldehyde$|^acetaldehyde$', pol)) %>%
           dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                           fuel_names == 'kerosene' |
                                           fuel_names == 'wood shims' | 
                                           fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  carbs_pertest <- dplyr::filter(per_test, grepl('^formaldehyde$|^acetaldehyde$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)
  
 # rho calculations
  rho_sp <- cor(carbs$formaldehyde, carbs$acetaldehyde, method = "spearman")
  rho_pear <- cor(carbs$formaldehyde, carbs$acetaldehyde, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))
  
  ggplot() + 
          geom_point(data = carbs, aes(x = formaldehyde, y = acetaldehyde, colour = fuel_names), shape = 17, size = 5) +
          geom_point(data = carbs_pertest, aes(x = formaldehyde, y = acetaldehyde, colour = fuel_names), 
                     shape = 1, size = 3, stroke = 1.5) +
        geom_text(data = rhos, aes(x = 0.53, y = 1.0, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
            geom_text(data = rhos, aes(x = 0.5, y = 0.88, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          ylab("acetaldehyde") +
          xlab("formaldehyde") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```

### benzene vs toluene

* g/kg

```{r, echo=FALSE, fig.width = 6}
  voc <- dplyr::filter(per_fuel_mass, grepl('^voc_benzene$|^voc_toluene$', pol)) %>%
         dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                         fuel_names == 'kerosene' |
                                         fuel_names == 'wood shims' | 
                                         fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  voc_pertest <- dplyr::filter(per_test, grepl('^voc_benzene$|^voc_toluene$', pol)) %>%
                 dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                 tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(voc$voc_benzene, voc$voc_toluene, method = "spearman")
  rho_pear <- cor(voc$voc_benzene, voc$voc_toluene, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))
  

  ggplot() +
          geom_point(data = voc, aes(x = voc_benzene, y = voc_toluene, colour = fuel_names), shape = 17, size = 5) +
          geom_point(data = voc_pertest, aes(x = voc_benzene, y = voc_toluene, colour = fuel_names), 
                     shape = 1, size = 3, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 0.9, y = 0.17, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          geom_text(data = rhos, aes(x = 0.875, y = 0.15, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          ylab("toluene") +
          xlab("benzene") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```

### PM vs formaldehyde

* g/kg

```{r, echo=FALSE, fig.width = 6}
  pmfor <- dplyr::filter(per_fuel_mass, grepl('^grav$|^formaldehyde$', pol)) %>%
           dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                           fuel_names == 'kerosene' |
                                           fuel_names == 'wood shims' | 
                                           fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  pmfor_pertest <- dplyr::filter(per_test, grepl('^grav$|^formaldehyde$', pol)) %>%
                 dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                 tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(pmfor$grav, pmfor$formaldehyde, method = "spearman")
  rho_pear <- cor(pmfor$grav, pmfor$formaldehyde, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = pmfor, aes(x = grav, y = formaldehyde, colour = fuel_names), shape = 17, size = 5) +
          geom_point(data = pmfor_pertest, aes(x = grav, y = formaldehyde, colour = fuel_names), 
                     shape = 1, size = 3, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 47, y = 1.55, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          geom_text(data = rhos, aes(x = 45, y = 1.45, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          ylab("formaldehyde") +
          xlab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```

### PM vs acetaldehyde

* g/kg

```{r, echo=FALSE, fig.width = 6}
  pmacet <- dplyr::filter(per_fuel_mass, grepl('^grav$|^acetaldehyde$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  pmacet_pertest <- dplyr::filter(per_test, grepl('^grav$|^acetaldehyde$', pol)) %>%
                 dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                 tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(pmacet$grav, pmacet$acetaldehyde, method = "spearman")
  rho_pear <- cor(pmacet$grav, pmacet$acetaldehyde, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = pmacet, aes(x = grav, y = acetaldehyde, colour = fuel_names), shape = 17, size = 5) +
          geom_point(data = pmacet_pertest, aes(x = grav, y = acetaldehyde, colour = fuel_names), 
                     shape = 1, size = 3, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 50, y = 1.1, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          geom_text(data = rhos, aes(x = 48, y = 0.99, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          ylab("acetaldehyde") +
          xlab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```

### PM vs benzene

* g/kg

```{r, echo=FALSE, fig.width = 6}
  pmbenz <- dplyr::filter(per_fuel_mass, grepl('^grav$|^voc_benzene$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  pmbenz_pertest <- dplyr::filter(per_test, grepl('^grav$|^voc_benzene$', pol)) %>%
                 dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                 tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(pmbenz$grav, pmbenz$voc_benzene, method = "spearman")
  rho_pear <- cor(pmbenz$grav, pmbenz$voc_benzene, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = pmbenz, aes(x = grav, y =voc_benzene, colour = fuel_names), shape = 17, size = 5) +
          geom_point(data = pmbenz_pertest, aes(x = grav, y =voc_benzene, colour = fuel_names), 
                     shape = 1, size = 3, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 55, y = 1.2, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          geom_text(data = rhos, aes(x = 53, y = 1.1, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          ylab("benzene") +
          xlab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```

### PM vs toluene

* g/kg

```{r, echo=FALSE, fig.width = 6}
  pmtol <-  dplyr::filter(per_fuel_mass, grepl('^grav$|^voc_toluene$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  pmtol_pertest <- dplyr::filter(per_test, grepl('^grav$|^voc_toluene$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(pmtol$grav, pmtol$voc_toluene, method = "spearman")
  rho_pear <- cor(pmtol$grav, pmtol$voc_toluene, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = pmtol, aes(x = grav, y = voc_toluene, colour = fuel_names), shape = 17, size = 5) +
          geom_point(data = pmtol_pertest, aes(x = grav, y = voc_toluene, colour = fuel_names), 
                     shape = 1, size = 3, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 55, y = 0.215, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          geom_text(data = rhos, aes(x = 53, y = 0.20, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          ylab("toluene") +
          xlab("PM2.5") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```


### CO vs formaldehyde

* g/kg

```{r, echo=FALSE, fig.width = 6}
  cofor <- dplyr::filter(per_fuel_mass, grepl('^co$|^formaldehyde$', pol)) %>%
           dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                           fuel_names == 'kerosene' |
                                           fuel_names == 'wood shims' | 
                                           fuel_names == 'kindling', 
                                          'conventional', 'nonconventional')) %>%
          dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
          tidyr::spread(pol, mean)

  cofor_pertest <- dplyr::filter(per_test, grepl('^co$|^formaldehyde$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(cofor$co, cofor$formaldehyde, method = "spearman")
  rho_pear <- cor(cofor$co, cofor$formaldehyde, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = cofor, aes(x = co, y = formaldehyde, colour = fuel_names), shape = 17, size = 5) +
          geom_point(data = cofor_pertest, aes(x = co, y = formaldehyde, colour = fuel_names), 
                     shape = 1, size = 3, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 35, y = 1.4, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          geom_text(data = rhos, aes(x = 34.5, y = 1.3, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
        ylab("formaldehyde") +
          xlab("CO") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```

### CO vs acetaldehyde

* g/kg

```{r, echo=FALSE, fig.width = 6}
  coacet <- dplyr::filter(per_fuel_mass, grepl('^co$|^acetaldehyde$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  coacet_pertest <- dplyr::filter(per_test, grepl('^co$|^acetaldehyde$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)


 # rho calculations
  rho_sp <- cor(coacet$co, coacet$acetaldehyde, method = "spearman")
  rho_pear <- cor(coacet$co, coacet$acetaldehyde, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = coacet, aes(x = co, y = acetaldehyde, colour = fuel_names), shape = 17, size = 5) +
          geom_point(data = coacet_pertest, aes(x = co, y = acetaldehyde, colour = fuel_names), 
                     shape = 1, size = 3, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 35, y = 1.1, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          geom_text(data = rhos, aes(x = 34.3, y = 1.0, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          ylab("acetaldehyde") +
          xlab("CO") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```

### CO vs benzene

* g/kg

```{r, echo=FALSE, fig.width = 6}
  cobenz <- dplyr::filter(per_fuel_mass, grepl('^co$|^voc_benzene$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  cobenz_pertest <- dplyr::filter(per_test, grepl('^co$|^voc_benzene$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(cobenz$co, cobenz$voc_benzene, method = "spearman")
  rho_pear <- cor(cobenz$co, cobenz$voc_benzene, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = cobenz, aes(x = co, y = voc_benzene, colour = fuel_names), shape = 17, size = 5) +
          geom_point(data = cobenz_pertest, aes(x = co, y = voc_benzene, colour = fuel_names), 
                     shape = 1, size = 3, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 43, y = 0.9, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          geom_text(data = rhos, aes(x = 43, y = 1.0, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          ylab("benzene") +
          xlab("CO") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```

### CO vs toluene

* g/kg

```{r, echo=FALSE, fig.width = 6}
  cotol <- dplyr::filter(per_fuel_mass, grepl('^co$|^voc_toluene$', pol)) %>%
            dplyr::mutate(fuel_cat = ifelse(fuel_names == 'newspaper' | 
                                            fuel_names == 'kerosene' |
                                            fuel_names == 'wood shims' | 
                                            fuel_names == 'kindling', 
                                           'conventional', 'nonconventional')) %>%
           dplyr::select(fuel_names, fuel_cat, pol, mean) %>%
           tidyr::spread(pol, mean)

  cotol_pertest <- dplyr::filter(per_test, grepl('^co$|^voc_toluene$', pol)) %>%
                   dplyr::select(id, fuel_names, pol, mass_pol_per_mass_fuel) %>%
                   tidyr::spread(pol, mass_pol_per_mass_fuel)

 # rho calculations
  rho_sp <- cor(cotol$co, cotol$voc_toluene, method = "spearman")
  rho_pear <- cor(cotol$co, cotol$voc_toluene, method = "pearson")
  rhos <- data.frame(c(rho_sp, rho_pear))
  colnames(rhos) <- "val"
  rhos <- rhos %>%
          dplyr::mutate(type = c("Spearman: ", "Pearson: "),
                        val = round(rhos$val, 2),
                        text = paste0(type, val))

  ggplot() + 
          geom_point(data = cotol, aes(x = co, y = voc_toluene, colour = fuel_names), shape = 17, size = 5) +
          geom_point(data = cotol_pertest, aes(x = co, y = voc_toluene, colour = fuel_names), 
                     shape = 1, size = 3, stroke = 1.5) +
          geom_text(data = rhos, aes(x = 15, y = 0.24, label = text[1]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          geom_text(data = rhos, aes(x = 13, y = 0.22, label = text[2]), 
                      color = 'black',  parse = TRUE,
                      size = 5) +
          ylab("toluene") +
          xlab("CO") +
          scale_color_hue(l=50, c=80) +
          theme_bw() +
          theme(text = element_text(size = 14),
                legend.position = "right",
                legend.key.size = unit(0.1, "cm"),
                legend.title = element_blank())
```

