---
title: "Startup Manuscript"
output: html_document
---

```{r global_options, include = FALSE}
  knitr::opts_chunk$set(fig.path = 'figures/',
                        warning = FALSE,
                        message = FALSE,
                        fig.width = 10, fig.height = 4,
                        cache = FALSE)
```

```{r setup, include=FALSE}
  library(tidyverse)
  library(knitr)
  source("../r_scripts/R_functions.R")
```

```{r, include=FALSE}
  emission_factors <- readRDS(file = "../r_files/emission_factors.RDS")
```


# Results

## Prepare data

```{r include = FALSE}
# set variable types from character -> factor
# filter out bad QC data
# set fuel type order by survey result "commonality" of use. 
# create variable mass (g) pollutant emitted per startup event
# create variable average mass (g) of startup material per startup event
# filter out backgrounds and blanks
  per_startup <- dplyr::mutate(emission_factors, fuel = factor(fuel),
                                                 qc = factor(qc),
                                                 pol = factor(pol)) %>%
                 dplyr::rename(mass_emitted = value) %>%
                 dplyr::select(-metric) %>%
                 dplyr::filter(qc != "bad") %>%
                 dplyr::mutate(fuel = forcats::fct_relevel(fuel, "background",
                                                                 "kerosene",
                                                                 "plastic_bags",
                                                                 "newspaper",
                                                                 "leaves_twigs",
                                                                 "rubber",
                                                                 "flipflops",
                                                                 "t_shirts",
                                                                 "food_packaging",
                                                                 "wood_shims")) %>%
                 dplyr::mutate(fuel_names = forcats::fct_recode(fuel, "plastic bags" = "plastic_bags",
                                                                      "kindling" = "leaves_twigs",
                                                                      "inner tubes" = "rubber",
                                                                      "footwear" = "flipflops",
                                                                      "fabric" = "t_shirts",
                                                                      "wood shims" = "wood_shims",
                                                                      "food packaging" = "food_packaging"),
                            mass_pol_per_startup = (mass_emitted * 1e-3) / fuel_quant, # mg per startup event
                            mass_fuel_per_startup = fuelmass_total / fuel_quant) %>%  # g per startup event
              dplyr::filter(!grepl("^B", id_test))
```


## Table 1



```{r}
fuel_sum <- dplyr::filter(per_startup, pol == 'grav') %>% 
            dplyr::group_by(fuel_names) %>%
            dplyr::summarize(n_tests = n(),
                             n_events_per_test = round(mean(fuel_quant), 2),
                             min_events_per_test = min(fuel_quant),
                             max_events_per_test = max(fuel_quant),
                             mean_fuelmass_per_event_g = round(mean(mass_fuel_per_startup), 2))

knitr::kable(fuel_sum)
```