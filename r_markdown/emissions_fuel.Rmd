---
title: "Fuel burned"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r, echo=FALSE, include=FALSE}
  library(tidyverse)
  library(knitr)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path = 'figures/', warning = FALSE, message = FALSE,
                        fig.width=10, fig.height = 4, cache = TRUE)
```

```{r}
  source("../r_scripts/R_functions.R")
```

# Load

* constants

```{r}
  #load("../r_files/calc_constants.RDS")
```

* metadata

```{r}
  samples <- readRDS("../r_files/samples.RDS")
  test_times <- readRDS("../r_files/test_times.RDS")
  fuel_wgts <- readRDS("../r_files/fuel_wgts.RDS")
```

# Timestamps

```{r}
  times <- dplyr::filter(test_times, var == "set_1" | var == "end") %>%
           tidyr::spread(var, value) %>%
           dplyr::select(-date) %>%
           dplyr::rename(start = set_1, end = end)
```

# Fuel

## wood stoves

* fuel consumed

```{r}
  wood_mass <- dplyr::filter(fuel_wgts, var == "fuel" |
                                        var == "ashpot_unusedfuel" |
                                        var == "ashpot_char_ash" |
                                        var == "ashpot_lid") %>%
                tidyr::spread(var, value) %>%
                dplyr::rename(wgt_fuel = fuel,
                              wgt_pot_unusedfuel = ashpot_unusedfuel,
                              wgt_pot_char_ash = ashpot_char_ash,
                              wgt_pot = ashpot_lid) %>%
                dplyr::mutate(mass_fuel = wgt_fuel -
                                          wgt_pot_unusedfuel -
                                          wgt_pot_char_ash +
                                          2 * wgt_pot)
```

## merge

```{r}
  fuel_burnt <- dplyr::bind_rows(dplyr::select(batch_mass, id, mass_fuel),
                                 dplyr::select(wood_mass, id, mass_fuel)) %>%
                dplyr::mutate(id = as.factor(id)) %>%
                dplyr::filter(grepl("^[0-9]", id) == TRUE)
```

# Plot

```{r, fig.width=12, fig.height=8}
  p_data <- dplyr::left_join(samples, fuel_burnt) %>%
            dplyr::mutate(id = as.factor(id)) %>%
            dplyr::filter(grepl("^[0-9]", id) == TRUE)

  ggplot(p_data, aes(x = id, y = mass_fuel, colour = stove)) +
        geom_point() +
        theme_minimal() + 
        theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
        theme(legend.position = "top") +
        ylab("fuel burnt (g)")
```

# Save

```{r}
  saveRDS(fuel_burnt, file = "../r_files/fuel_burnt.RDS")
```

___

