---
title: "Fuel burned"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r, echo=FALSE, include=FALSE}
  library(tidyverse)
  library(knitr)
```

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path = 'figures/', warning = FALSE, message = FALSE,
                        fig.width=10, fig.height = 4, cache = FALSE)
```

```{r}
  source("../r_scripts/R_functions.R")
```

---

# Load

* metadata

```{r}
  samples <- readRDS("../r_files/samples.RDS")
  test_times <- readRDS("../r_files/test_times_all.RDS")
  fuel_wgts <- readRDS("../r_files/fuel_wgts.RDS")
```


---

# Fuel

* fuel consumed

```{r}
  
  fuel_burnt <- fuel_wgts %>%
                tidyr::spread(var, val) %>%
                dplyr::select(id, mass_dry_new_sum, wgt_ashpot_lid, 
                              wgt_ashpot_unusedfuel, wgt_ashpot_char_ash) %>%
                dplyr::mutate(wgt_ashpot_unusedfuel = ifelse(is.na(wgt_ashpot_unusedfuel),
                                                             wgt_ashpot_lid,
                                                             wgt_ashpot_unusedfuel),
                              unused_fuel = wgt_ashpot_unusedfuel - wgt_ashpot_lid,
                              char_ash    = wgt_ashpot_char_ash - wgt_ashpot_unusedfuel,
                              
                              # This is incorrect because:
                              # 1. It does not account for the moisture content of the unburned fuel
                              # 2. It does not account for the fact that char != fuel
                              mass_burned_wrong = mass_dry_new_sum - unused_fuel - char_ash,
                              units = "g")
```

```{r, fig.width = 12, fig.height = 8}
  p_data <- dplyr::left_join(samples, fuel_burnt) %>%
            dplyr::mutate(id = as.factor(id))

  ggplot(p_data, aes(x = id, y = mass_burned_wrong, colour = stove)) +
        geom_point() +
        theme_minimal() + 
        theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
        theme(legend.position = "top") +
        ylab("fuel burnt (g)")
```

---

# Save

```{r}
  saveRDS(fuel_burnt, file = "../r_files/fuel_burnt.RDS")
```

---

