---
title: "Emissions Analysis"
author: "Kristen Fedak"
date: "July 17, 2017"
output: html_document
---


```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  library(tidyverse)
  library(knitr)
```

# Load and format data
```{r}
  emission_factors <- readRDS(file = "../r_files/emission_factors.RDS")
```

```{r}
#set variable types from character -> factor
#filter out bad QC data
  ef_bymass <- dplyr::mutate(emission_factors, fuel = factor(fuel),
                                              qc = factor(qc),
                                              pol = factor(pol)) %>%
               dplyr::filter(qc != "bad")

#check how many rows (pollutants) per test
table(ef_bymass$id)

```
* Expected number of rows: 896 
** 25 pol x 34 tests + 1 pol x 8 tests (blanks #36-43, grav only) + 0 pol x 2 tests (full censor for bad QC on #8, 24) + 20 x 1 test (#44; no VOCs) + 9 pol x 2 tests (#1,30; no carbonyls - censored for bad QC). 
* final dataset = 942 rows - 46 more than expected! 
* using `table(ef_bymass$id)`, discovered that id #8 has all 25 when expect 0; #24 has 22 when expect 0. #1 has only 8 (expect 9).  
** #1 was missing gravametric from the QC-filtered set but not full set because QC = NA. 
** #24 has only 5gas as qc=bad, carbs and grav are maybe where VOCs are OK (should be whole test = bad). 
** #8 all QC are maybe or OK (should be whole test = bad). 

* NEED TO GO BACK AND FIGURE OUT WHERE/HOW TO CENSOR THIS DATA APPROPRIATELY. 


# Summarize emissions factors by pollutant and fuel type
```{r}
ef_sum <- ef_bymass %>%
                    dplyr::group_by(fuel, pol) %>%
                    dplyr::summarize(nreps = n(),
                                     mean_ef = round(mean(mass_per_mass_fuel, na.rm = TRUE), 4),
                                     min_ef = round(min(mass_per_mass_fuel, na.rm = TRUE), 4),
                                     max_ef = round(max(mass_per_mass_fuel, na.rm = TRUE), 4))
#mass_ef in units g pol / kg fuel; one average value per fuel_type

ef_mean_table <- select(ef_sum, fuel, pol, mean_ef) %>%
                 spread(fuel, mean_ef) %>%
                 select(-background, -blank)
```

### Table 1. Mean emission factors (mass basis) for various startup materials and pollutants
* units = g pollutant emitted per kg of fuel burned
```{r echo = FALSE}
knitr::kable(ef_mean_table)
```

# Figure 1. Mean emission factors (mass basis) for various startup materials and pollutants

```{r}
  
```

