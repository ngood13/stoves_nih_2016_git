---
title: "Emission Factor Summary"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  library(tidyverse)
  library(forcats)
```

# Load and tidy data

* Load data and meta data

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  load("../r_files/emission_factors.Rda")
  load("../r_files/samples.Rda")
```

* Load functions

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  source("../r_scripts/R_functions.R")
```

* Output emissions factors column names 

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  colnames(emission_factors)
```

* Add stove/fuel information

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  emission_factors <- dplyr::left_join(emission_factors, 
                                       dplyr::select(samples, id, stove, fuel,
                                                              fuelcat, stovecat),
                                       by = "id")
```

# CO data

* Plot emissions factors by mass, energy of fuel and energy delivered

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width = 14,  fig.height = 10}
  plot_mass_ef(dplyr::filter(emission_factors, grepl('^co', pol)), 'CO')
```

# PM data

* Plot emissions factors by mass, energy of fuel and energy delivered

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width = 14,  fig.height = 5}
  plot_mass_ef(dplyr::filter(emissions, grepl('grav', pol)), 'PM', "mass")
```

# VOC data

* Plot emissions factors by mass, energy of fuel and energy delivered

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width = 14,  fig.height = 10}
  plot_mass_ef(dplyr::filter(emissions, grepl('^voc_benzene|^voc_toluene', pol)), 'VOCs', "mass")
```
