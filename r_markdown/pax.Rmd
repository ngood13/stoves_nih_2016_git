---
title: "pax"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  library(tidyverse)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  source("../r_scripts/R_tidy.R")
  source("../r_scripts/R_functions.R")
```

# Load pax data

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  pax <- readRDS("../r_files/pax.RDS")
```

# Load metadata

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  test_info <- readRDS("../r_files/test_info.RDS")
  times_fuel <- readRDS("../r_files/times_fuel.RDS")
  times_bg <- readRDS("../r_files/times_bg.RDS")
  times_test <- readRDS("../r_files/times_test.RDS")
  flow <- readRDS("../r_files/flows.RDS")
  notes <- readRDS("../r_files/notes.RDS")
```

# Organize

## sample times

* full test

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  pax_full <- filter_times_startup(times_test, pax)
```

* background levels

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  pax_bg <- filter_times_background(times_bg, pax)
```

* levels by replicate

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  pax_rep <- filter_times_rep(times_fuel, pax)
```

## Flows

* fix problem?

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  flow <- dplyr::filter(flow, inst == "pax") %>%
          dplyr::select(id, mean, delta) %>%
          dplyr::rename(flow_mean = mean,
                        flow_delta = delta)
```

* append to data

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  pax <- dplyr::left_join(pax_full, flow, "id")
```

# Info

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  info <- dplyr::select(test_info, id_test, id, fuel_type, fuel_quant)

  pax <- dplyr::left_join(pax, info, "id")
```

# QC

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  notes <- dplyr::filter(notes, grepl("pax|all", notes$notes) == TRUE)
```

# Save

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  saveRDS(pax, file="../r_files/pax_merged.RDS")
```

# Plots

# Data summary

The PAX measured during `r length(unique(pax$id))` experiments between `r min(pax$date, na.rm = TRUE)` and `r max(pax$date, na.rm = TRUE)`. There is no PAX data for tests: `r setdiff(as.character(test_info$id), as.character(pax$id))`.

Tests 36 through 43 are blanks; no fivegas data expected.
PAX file currently missing for test day 11/17/2016 (tests 6, 9, 33). KF searching for file as of 5/8/17. 
