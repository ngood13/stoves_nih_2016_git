---
title: "Fivegas Data Processing"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  library(tidyverse)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  source("../r_scripts/R_tidy.R")
  source("../r_scripts/R_functions.R")
```

# Load data

* fivegas

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  data <- readRDS("../r_files/fivegas.RDS")
```

* sample information

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  test_info <- readRDS("../r_files/test_info.RDS")
```

* sample times

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  times_fuel <- readRDS("../r_files/times_fuel.RDS")
  times_bg <- readRDS("../r_files/times_bg.RDS")

```

* notes

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  notes <- readRDS("../r_files/notes.RDS")
```

# QC

No notes indicating bad qc data.

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  notes$qc <- "ok"
```

#

# Save merged file

```{r, echo=TRUE, warning=FALSE, message=FALSE, results='markup', cache=FALSE}
  save(fivegas_merged, file = "../r_files/fivegas_merged.Rda")
```

# Summary

The Fivegas analyzer measured during `r length(unique(fivegas_merged$id))` experiments between `r min(fivegas_merged$date, na.rm = TRUE)` and `r max(fivegas_merged$date, na.rm = TRUE)`. There is no $Fivegas$ data for tests: `r setdiff(as.character(samples$id), as.character(fivegas_merged$id))`.

$Fivegas$ data is expected to be missing for: 

* all "G" tests: five gas not run during backgrounds.

* 1B, 2A: "no data" noted on QC log

* 4A: only calibration file for this test day was found (2/24/2016); five gas file is lost.

* calibration files for 2016/03/09 and 2016/04/01 missing (check)

# Plots

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='markup', cache=FALSE, fig.width=12, fig.height=40, eval=TRUE}
  df <- dplyr::mutate(fivegas_merged, id = as.character(id)) %>%
        dplyr::arrange(id) %>%
        dplyr::mutate(id = as.factor(id))

  ggplot(df, aes(datetime, ppm, colour = qc, group = pol)) + 
    geom_line() +
    scale_y_log10(limits = c(1, 10^5)) +
    scale_colour_manual(values = 
                        c("ok" = "mediumaquamarine",
                          "maybe" = "mediumorchid1",
                          "bad" = "darkorange1")) +
    facet_wrap(~id, ncol = 3, scale = "free") +
    theme_minimal() +
    xlab("") +
    theme(legend.position = "top")
```
