---
title: "Checking / Analysis"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r global_options, include=FALSE}
  knitr::opts_chunk$set(fig.path = 'figures/',
                        warning = FALSE,
                        message = FALSE,
                        fig.width = 10, fig.height = 4,
                        cache = FALSE,
                        results='markup')
```

```{r, echo=FALSE}
  library(tidyverse)
  library(knitr)
```

---

# Load

```{r}
  emission_factors <- readRDS(file = "../r_files/emission_factors.RDS")

  emissions_pol <- readRDS(file = "../r_files/emissions_long.RDS")

  fivegas <- readRDS(file = "../r_files/fivegas_full.RDS")

  tests <- readRDS(file = "../r_files/test_info.RDS")
  
  fuel_consumed <- readRDS(file = "../r_files/fuel_burnt_test.RDS")
```

# Extract metrics

```{r}
  mass_emitted <- emission_factors %>%
                  dplyr::filter(metric == "mass_emitted")
```

# CO2

```{r}
  p_data <- dplyr::filter(mass_emitted, pol == "co2")

  p <- ggplot(p_data, aes(id, value)) +
       geom_point(aes(color = qc)) +
       theme_minimal()
  
  p
```


```{r}
  emissions_co2 <- dplyr::filter(emissions_pol,
                                 pol == "co2",
                                 metric == "mass_emitted") %>%
                   dplyr::select(id, value) %>%
                   dplyr::rename(mass_emitted = value)
  
  co2 <- dplyr::filter(fivegas, pol == "co2") %>%
         dplyr::group_by(id) %>%
         dplyr::summarise(avg = mean(val, na.rm = TRUE)) %>%
         dplyr::right_join(dplyr::select(tests, id, fuel), by = "id") %>%
         dplyr::left_join(dplyr::select(fuel_consumed, id, fuelmass_total), by = "id") %>%
         dplyr::left_join(emissions_co2, by = "id")
```






